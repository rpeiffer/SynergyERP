! >>> Program 454spb
!
! description Ship To Customer Product 12 month details
!
! loadsave -w -n 100,10 -o prog/dxport/454spb.dl4 src/454spb.src
!
! 1.0 mm/dd/yyyy change??
!
include "src/copyright.inc" ! dx
!
Rem BEDIT Version: 2.2 OBJECT CODE     Created: JUL 29, 2005  14:56:27
Rem /w2/papermaster/r2005//usr/acct/dek/work/r2005/mx/mx454b.src (univ2) [dek] {24347}
Rem  Copyright (c) 2005 Universal Business Systems, Inc.
Rem    **** ALL CHANGES MUST BE MADE IN SOURCE!!! ****
Rem
Rem MX454spb - CUSTOMER/PRODUCT 12 MONTH SALES
Rem AUTHOR: DAVE  DEC 29, 1987
Rem LAST UPDATE: roman 07/05/1991  units conversion / clean up
!task# 27156 - custom_customer$="JPAPER" 07/01/03 zyc cct169078 - removed "LAST PRICE" info
!
External Lib "ubsfunc.dl4"
Declare External Sub UTMonths
declare external function GetUIDSalesrep
!
External Lib "libprod.lib"
Declare External Sub ProdGroup
!
Declare Intrinsic Sub InpBuf,String
! - Option Default Dialect IRIS1
Com 1%,PFU1[20],CNVTU[2],MONTH_[4]
Com 3%,PFU2[6],CNVTA,A[33]
Com MTH$[108]
If Err 0 Gosub ERR_TRAP
Def FNR(X) = Sgn(X) * (Int(Abs(X) + .5))
!
dim e$[500],buttonlist$[5,50],nextlist$[5,100] ! dx error handling variables
!
dim CustName$[30],ProdDesc$[30],ProdDesc2$[30]
Dim 1%,F,X0,WHSE,BOYMONTH,L9,ARMONTH,CHAN,PRINT_QTY,LPC3[4]
DIM 1%,CLFLAG,FYE,MTH,GL2[4],GL[17],ch_pw,fmonth[25]
DIM 1%,warehs
dim 2%,sship,eship
Dim 3%,r[50],tmp3,tmp4
dim keyship$[50],slname$[30],keysl$[50],slcust$[20],keycust$[50],sHIPname$[30],SHIPST$[3]
dim 2%,SLSLSM,1%,SLDIV
! Dim P9$[50],Z1$[50],S1$[50],K10$[50],K9$[50],K4$[50]
DIM 2%,CLIENT,P8[14],WHCLIENT,DIVCLIENT
Dim 2%,C1[12],X2,MAXDEPT,CATGY[1]
DIM 3%,DIV,S5[12,2],PARM[10],WHMISC2[7]
Dim 3%,S1[12,2],S2[12,2],J,T7[12,2],T8[12],T9[12,2],Y9[12,8]
Dim 3%,G9[12,2],G8[12,5],Z1[12,2],Z2[12,2],W3[24],LPC2[2]
Dim K1$[50],K2$[20],K3$[20],BREAK$[30],X$[10],P$[12],K6$[30],Z1$[50]
DIM K12$[30],GL$[140],P8$[8]
Dim S1$[50],A$[156],P9$[50],DT$[1],TITLE$[20],K5$[14],SELLUM$[4],CCD$[14]
Dim J$[40],CNAME$[30],J2$[20],J3$[40],J4$[40],ARDATE$[8],J9$[3],C1$[142]
Dim I1$[50],LPRICE$[15],LPUM$[10],STPROD$[12],LSTPROD$[12],SPACES$[12]
dim kpw$[50],3%,repSecurity
dim custom_customer$[30]
Dim 3% ! need 3% for some files, especially slscurr
!!!! dx add xport reporting code
dim tmp$[500]
dim action$[30],options$[30],userid$[8],b$[200],3%,fdel$[10],rstr$[200],bsdel$[10],esdel$[10],rdel$[10]
call getsession(e$,CTLC,options$,action$,userid$,intCO,intSls,fdel$,rstr$,bsdel$,esdel$,rdel$)
!

Read #1,88,1632;J$;
Ropen #20,J$ ! DEPTFLE
MAXDEPT = Chf(20) - 1 \ Close #20
For J = 2 To 14
  Read J1 \ If J1 = -1 Goto L_830
  Read #1,88,J1;J$;
  Ropen #J,J$
L_830: Next J
Data "1808","1792","2016","1744","1728","2288","1728","-1","1376","1824","-1","688", "2112"
! #2 - Cust, 3- product, #4-SLSCURR, 5-PRODWHSE, 6-CCODES, 7 -COMMHEAD, 8-CCODES, 9 -SORT
!#10 - LASTPRICE, #11-SSLSM, #12-N/U, #13-DIVIFLE, #14-SHIPLIST
!#30 - SLLASTPRICE, #34 - CSLSALES 
ch_pw=5
let j$="3/SLLSTPRC"+str$(intco)
ropen #30,j$
let j$="4/CSLSALES"+str$(intco)
Ropen #34,j$
mat read #1,115,60;custom_customer$;
custom_customer$=UCase$(Trim$(custom_customer$))
repSecurity = GetUIDSalesrep(e$)
if repSecurity < 0
	e$="User ID not on file!"
	error 10000
end if
Mat Read #1,0,100;ARDATE$;
Mat Read #1,51,74;BOYMONTH;
Mat Read #1,0,120;ARMONTH;
Mat Read #1,3;CNAME$;
MAT  READ #1,51,0;GL; \ MAT  READ #1,51,72;GL2;
MAT  READ #1,52,0;P8; \ MAT  READ #1,52,60;P8$;
MAT  READ #1,19,50;P9$;  
IF P9$[17,17]="Y"                   
  READ #1,88,48;J$; \ ROPEN #12,J$  
ENDIF
If Err 0 Let J8 = Spc(8)
J8 = 0 \ J9 = Chf(0)
If Err 0 Gosub ERR_TRAP
If J8 If J8 <> 49 Gosub ERR_TRAP
J9 = 63 \ If J8 Let J9 = 21
!
MONTH_[1] = 1;MONTH_[2] = 0 \ rem ! - Call "UTMONTHS",MONTH_[],MTH$
Call UTMonths(e$,MONTH_[],MTH$,BOYMONTH) ! set up month headers
!

if J8 ! dx xml, setup rstr$
 !<section>
 tmp$=bsdel$,"454spb",fdel$,rdel$
 call addtostr(e$,rstr$,tmp$)
End if
!
!!!! dx add xport reporting code
call dxget("k2",k2$) ! starting customer
call dxget("k3",k3$) ! ending customer
call dxget("j2",J2$) ! starting cust category
call dxget("j3",J3$) ! ending cust category
call dxget("stprod",StProd$) ! starting product
call dxget("lstprod",LstProd$) ! endng product
call dxget("x0",tmp$) \ x0=tmp$ ! period 1=this year, 2=last year, 3=both & 4=diff only
call dxget("f",tmp$) \ F=tmp$ ! 1=units & 2=dollars
call dxget("sort",tmp$) \ if rtrim$(tmp$)="" let Chan=14 else Chan=9 ! sort by category
call dxget("slsm",tmp$)
if repSecurity>0
	let tmp$ = str$(repSecurity)
endif
SLSM=tmp$ ! salesman #
call dxget("dt",tmp$) \ if rtrim$(tmp$)="" let DT$="N" else DT$="Y" ! cust totals only
call dxget("print_qty",tmp$)\ if rtrim$(tmp$)="" let Print_Qty=0 else Print_Qty=1 ! quantity on hand
!!!! dx end
!
X2=K2$ \ K2$ = X2 Using "######"
if X2<0 or X2>999999 let e$="Invalid starting customer, must be between 0 and 999999!" \ error 10000
!
if rtrim$(K3$)="" let K3$="999999"
X2=K3$ \ K3$ = X2 Using "######"
if K3$<K2$ or X2>999999 let e$="Invalid ending customer, must be between starting customer and 999999!" \ error 10000

! ship to code
Call dxget("SSHIP",J$) \ SSHIP = rtrim$(J$)
Call dxget("ESHIP",J$) \ if RTRIM$(j$)="" let J$="999999"
ESHIP = J$
If SSHIP > ESHIP
Let E$ = "ENDING SHIPTO MUST BE GREATER THAN OR EQUAL TO STARTING SHIPTO!" \ error 10000
ENDIF 
call dxget("WHSE",J$)
If rtrim$(j$)=""
	let warehs=0
else
	let warehs=rtrim$(j$)
	if warehs<0 or warehs>99
		let e$="Invalid Warehouse Entered" \ error 10000
	endif
endif
!
X2 = J2$ \ J2$ = X2 Using "###" \ CATGY[0] = X2
If X2 < 0 Or X2 > 999 let e$="Invalid starting category, must be between 0 and 999!" \ error 10000
!
if rtrim$(J3$) = "" Let J3$ = "999"
X2 = J3$ \ J3$ = X2 Using "###" \ CATGY[1] = X2
if J3$<J2$ or X2>999 let e$="Invalid ending category, must be between starting category and 999!" \ error 10000
!
if rtrim$(StProd$)="" let StProd$=" ",StProd$
!
if rtrim$(LstProd$)="" let LstProd$="~",LstProd$
StProd$=UCase$(STProd$);LstProd$=UCase$(LstProd$) ! code is UPPERCASE
if LstProd$<StProd$ let e$="Invalid ending product, must be > starting product!" \ error 10000
!
If X0 < 3 Let L9 = 4 ! period
If X0 = 3 Let L9 = 10
If X0 = 4 Let L9 = 6
!
F = F - 1 ! units/dollars
!
if SLSM<0 or SLSM>999 let e$="Invalid salesman, must be between 0 and 999!" \ error 10000
!
If DT$ = "Y" Or X0 = 2 Or X0 = 4 Or F = 1 Let PRINT_QTY = 0 ! last year or period
!
Spaces$=" ",spaces$
StProd$=StProd$,Spaces$ \ LstProd$=LstProd$,Spaces$ ! beg /end product
! note 6000 routine
LET CLFLAG=0;CLIENT=0;FYE=GL2[0];MONTH1=GL2[0]                                 
IF P8$[7,7]="W" or p8$[7,7]="D"
	let clflag=99
	if p9$[17,17]<>"Y" let clflag=0
	if gl[3]=0 let clflag=0
endif 
let client=0
if clflag<>0
	call dxget("CLIENT",Tmp$)
	if tmp$<>"" 
		let client=tmp$! 								 
		K12$=" ",K12$;K12$[3,6]=client USING "####"                             
		SEARCH #12,2,1;K12$,R12,E                                                   
		IF E<>0
			let e$="Client "+str$(client)+" Not on File " \ error 10000
		ENDIF                                                                                                                       
		MAT  READ #12,R12,0;GL$;                                                                        
		LET FYE=GL$[128,129]                                                        
	endif
endif
if client<>0
	let clflag=0
endif
LET MONTH1=GL2[0]                                                                                                                  
call dxget("YEARTYPE",Tmp$)
if rtrim$(tmp$)=""
	let x=1
else
	LET X=TMP$
endif
if x<1 or x>2
	let e$="Invalid Year Type Selected " \ error 10000
endif
IF X=1                                                                        
	LET MONTH1=12;BOYMONTH=1                                                     
ELSE                                                                          
	LET MONTH1=FYE                             
	LET BOYMONTH=MONTH1+1 \ IF BOYMONTH>13 LET BOYMONTH=1                        
ENDIF 
GOSUB L_6300:
!
MONTH_[1] = 1;MONTH_[2] = 0 \ rem ! - Call "UTMONTHS",MONTH_[],MTH$
Call UTMonths(e$,MONTH_[],MTH$,BOYMONTH) ! set up month headers
!

!
If J8 = 0 !if pdf or print, new method, after edits,setouput,dxclose
  Call setoutput(e$,rstr$,2) !2 flag puts 0 status section in w/print in process msg, puts </page> in
End If 


!
! - L_900: Rem "================================= picks
! - SPACES$ = "            "
! - Print 'CS';@0,0;"MX454B";@25,0;"CUSTOMER / PRODUCT SALES (FULL DETAIL)"
! - Print @0,3;"ENTER STARTING CUST, <CR> FOR FIRST,    E: TO EXIT: ";'CE';
! - Input ""K2$ \ If K2$ = "E" Goto OUTEND
! - X2 = K2$ \ K2$ = X2 Using "######"
! - Print @6,4;"ENDING   CUST, <CR> FOR LAST,     E: TO EXIT: ";'CL';
! - Input ""K3$ \ If K3$ = "E" Goto OUTEND
! - If K3$ = "" Let K3$ = "999999"
! - X2 = K3$ \ K3$ = X2 Using "######"
! - If K2$ > K3$ Gosub L_1400 \ Goto L_900
! - L_955: Rem "====== category sort picks
! - Print @0,6;'CE';"ENTER STARTING CUST CATEGORY, <CR> FOR FIRST,   E: TO EXIT: ";
! - Input ""J2$ \ If J2$ = "E" Goto OUTEND
! - X2 = J2$ \ If X2 < 0 Or X2 > 999 Goto L_955
! - J2$ = X2 Using "###";CATGY[0] = X2
! - L_976: Print @6,7;'CE';"ENDING   CUST CATEGORY, <CR> FOR LAST,    E: TO EXIT: ";
! - Input ""J3$ \ If J3$ = "E" Goto OUTEND
! - If J3$ = "" Let J3$ = "999"
! - X2 = J3$ \ If X2 < 0 Or X2 > 999 Goto L_976
! - J3$ = X2 Using "###";CATGY[1] = X2
! - If CATGY[0] > CATGY[1] Gosub L_1400 \ Goto L_955
! - Print @0,9;"ENTER STARTING PRODUCT <CR> FOR ALL ";
! - Input ""STPROD$
! - If STPROD$ = "" Let STPROD$ = " ",STPROD$ \ LSTPROD$ = "~",LSTPROD$ \ Goto L_1008
! - Print @6,10;"ENTER ENDING  PRODUCT <CR> FOR LAST ";
! - Input ""LSTPROD$
! - If LSTPROD$ = "" Let LSTPROD$ = "~",LSTPROD$
! - L_1008: If Len(STPROD$) < 12 Let STPROD$[Len(STPROD$) + 1,12] = SPACES$[Len(STPROD$) + 1,12]
! - If Len(LSTPROD$) < 12 Let LSTPROD$[Len(LSTPROD$) + 1,12] = SPACES$[Len(LSTPROD$) + 1,12]
! - L_1010: Print @0,12;'CE';"CHOOSE PERIOD:  1: THIS YEAR,  2: LAST YEAR,  3: BOTH,  4: DIFF ONLY: ";
! - Input ""J$
! - X0 = J$ \ If X0 < 1 Or X0 > 4 Goto L_1010
! - If X0 < 3 Let L9 = 4
! - If X0 = 3 Let L9 = 10
! - If X0 = 4 Let L9 = 6
! - L_1040: Print @0,13;'CE';"CHOOSE VALUES:  1: UNITS,  2: DOLLARS: ";
! - Input ""J$
! - F = J$ \ If F < 1 Or F > 2 Goto L_1040
! - F = F - 1
! - L_1060: CHAN = 0
! - Print @0,14;'CE';"CHOOSE SORT:   1: CUSTOMER CODE,  2: CUSTOMER CATEGORY: ";
! - Input ""J2$ \ If J2$ = "E" Goto OUTEND
! - If J2$ = "1" Let CHAN = 2
! - If J2$ = "2" Let CHAN = 9
! - If Not(CHAN) Goto L_1060
! - Goto L_1095
! - L_1095: Print @0,16;'CE';"ENTER SALESMAN NUMBER   0: FOR ALL,   E: TO EXIT: ";
! - Input ""S1$ \ If S1$ = "E" Goto OUTEND
! - SLSM = S1$
! - If SLSM < 0 Or SLSM > 999 Goto L_1095
! - L_1115: Print @0,17;"PRINT CUSTOMER TOTALS ONLY? (Y/N/E) ";
! - Input ""DT$ \ If DT$ = "E" Goto OUTEND
! - If DT$ <> "Y" And DT$ <> "N" Goto L_1115
! - If DT$ = "Y" Or X0 = 2 Or X0 = 4 Or F = 1 Let PRINT_QTY = 0 \ Goto L_1150
! - L_1130: Print @0,18;"PRINT QUANTITY ON HAND FIGURES? (Y/N/E) ";
! - Input ""J2$ \ If J2$ = "E" Goto OUTEND
! - If J2$ <> "Y" And J2$ <> "N" Goto L_1130
! - PRINT_QTY = 0 \ If J2$ = "Y" Let PRINT_QTY = 1
! - L_1150: Goto L_1450
! - L_1400: Print @0,22;"ENDING VALUE MUST BE GREATER THAN OR EQUAL TO STARTING VALUE! ";'RB CE';
! - Signal 3,50 \ Print @0,22;'CL' \ Return 
! - L_1450: Print @10,20;'CL'; \ Input "CHOOSE  P: Print,  R: Reselect,  E: Exit "Z1$ \ If Z1$ = "E" Goto L_9010
! - If Z1$ = "R" Goto L_900
! - If Z1$ <> "P" Goto L_1450
!
! *** Sort Section
If CHAN = 14 Goto L_1800
! - Print @0,22;'CE';"Clearing sort file..."; \ Signal 3,0
J4$ = " ",J4$
L_1515: Search #9,3,1;J4$,V1,E
If E Goto L_1535
Search #9,5,1;J4$,V1,E
If E Let e$ = "syserrorfile 454spb sortfile mode (m)=5 keyno (k)=1 r=",V1," e=",e," keyval (k$)=",J4$ \error 10000
Goto L_1515
!
L_1535: Rem SORT IT
! - Print @0,22;'CE';"Sorting...please wait"; \ Signal 3,0
K1$=" ",k1$
let k1$[1,6]= K2$[1,6]

L_1560: Search #14,3,1;K1$,R[14],E ! GOING THRU THE SHIPLIST FILE
If E Goto L_1800
L_1570: If K1$[1,6] > K3$[1,6] Goto L_1800 ! 
let tmp3=k1$[8,13]
! get the customer
if tmp3<sship goto L_1560
if tmp3>eship ! reach last ship code for that customer
	let k1$[8,13]="zzzzzz"
	goto L_1560
endif
if tmp3<sship goto L_1560
if tmp3>eship goto L_1560
let slslsm=0;sldiv=0
IF SLSM<>0
	mat read #14,r[14],390;SLSLSM;
	if slslsm<>0
		if slsm<>slslsm goto L_1560
	endif	
endif
let keycust$=" ",keycust$
let keycust$[1,6]=k1$[1,6]
search #2,2,1;keycust$,r1,e
if e<>0 goto L_1560:
! check shiokust
Mat Read #2,R1,142;C1;
If SLSM<>0 and SLSLSM=0
	If SLSM <> C1[2] Goto L_1560
endif
If C1[9] < CATGY[0] Goto L_1560
If C1[9] > CATGY[1] Goto L_1560
If clflag<>0
	Mat read #14,r[14],654;sldiv;
	if sldiv<>0
		let div=sldiv
	else
		MAT  READ #2,R1,568;DIV;
	endif
	IF P9$[17,17]="Y" AND GL[3]<>0 AND CLIENT<>0 AND P8$[7,7]="D"
		MAT  READ #13,DIV,76;DIVCLIENT;
		IF DIVCLIENT<>CLIENT GOTO L_1560:
	ENDIF
Endif
J4$ = " ",J4$;J4$ = C1[9] Using "###";J4$[4] = K1$
Search #9,4,1;J4$,R1,E 
If E Let e$ = "syserrorfile 454spb sortfile mode (m)=4 keyno (k)=1 r=",R1," e=",e," keyval (k$)=",J4$ \error 10000
Goto L_1560
!
! *** Process Section
L_1800: Rem "============================================ set up for print
! - MONTH_[1] = 1;MONTH_[2] = 0 \ Call "UTMONTHS",MONTH_[],MTH$
! - If MONTH_[0] Let E = 0 \ Gosub ERR_SEARCH
!
if j8 ! dx xml headings
  tmp$="CUST #",fdel$,"SHIP CODE",FDEL$,"CUSTOMER NAME",fdel$
  if DT$="N" ! detail
    tmp$=tmp$,"STATE",fdel$,"SALESMAN",fdel$
    tmp$=tmp$,"PRODUCT",fdel$,"PRODUCT DESC",fdel$
	tmp$=tmp$,"PRODUCT DESC #2",fdel$,"WHSE",fdel$
	If custom_customer$ <> "JPAPER"
		tmp$=tmp$,"LAST PRICE",fdel$
	endif
	if PRINT_QTY let tmp$=tmp$,"QTY AVAIL.",fdel$
  endif
  tmp$=tmp$,"DESCRIPTION",fdel$
  For I = 1 To 12
    tmp$=tmp$,MTH$[I * 3 - 2,I * 3],fdel$
  Next I
  !
  call addtostr(e$,rstr$,tmp$+rdel$)
end if
!
TITLE$ = " ",TITLE$;TITLE$ = "SALES - "
If F = 0 Let TITLE$ = TITLE$,"UNITS";J9$ = "UN"
If F = 1 Let TITLE$ = TITLE$,"DOLLARS";J9$ = "$"
If X0 = 1 And PRINT_QTY And F = 0 Let L9 = L9 + 1
If X0 = 3 And PRINT_QTY And F = 0 Let L9 = L9 + 2
! - Print @0,22;"Printing...please wait";'CE'; \ Signal 3,0
BREAK$ = " ",BREAK$ \ J1 = 70 \ J2 = 0
! - If J8 Print 'CS';
! - If Err 0 Gosub ERR_ESCAPE
If CHAN = 9 
	Let K1$ = " ",K1$ 
Else 
	Let K1$=" ",K1$
	LET K1$[1,6]= K2$[1,6]
	let k1$[7,7]="."
	if sship>0 let k1$[8,13]=(sship-1) using "&&&&&&"
ENDIF

L_2000: Search #CHAN,3,1;K1$,R[14],E
If E Goto L_9100
L_2010: !If CHAN = 2 If K1$[1,Len(K3$)] > K3$ Goto L_9100
IF CHAN<>14 ! If CHAN = 2 Goto L_2030
	If BREAK$[1,3] <> K1$[1,3] Gosub L_4500 ! CATEGORY BREAK
	BREAK$ = K1$[1,3] ! category break
	let keycust$=" ",keycust$
	let keycust$[1,6]=k1$[4,9]
	search #2,2,1;keycust$,r1,e
	IF E<>0 GOTO l_2000:
	let shipcode=k1$[11,16]
ELSE
	 If K1$[1,6] > K3$[1,6] Goto L_9100 ! ! CHECK CODE CODE RANGE
	 let tmp3=k1$[8,13]
	! get the customer
	if tmp3<sship goto L_2000
	if tmp3>eship ! reach last ship code for that customer
		let k1$[8,13]="zzzzzz"
		goto L_2000
	endif
	let shipcode=k1$[8,13]
	let slslsm=0;sldiv=0
	IF SLSM<>0
		mat read #14,r[14],390;SLSLSM;
		if slslsm<>0
			if slsm<>slslsm goto L_2000:
		endif
	endif
	let keycust$=" ",keycust$
	let keycust$[1,6]=k1$[1,6]
	search #2,2,1;keycust$,r1,e
	if e<>0 goto L_2000:
	Mat Read #2,R1,142;C1;
	If SLSM<>0 and SLSLSM=0
		If SLSM <> C1[2] Goto L_2000:
	endif
	If C1[9] < CATGY[0] Goto L_2000
	If C1[9] > CATGY[1] Goto L_2000
	If clflag<>0
		Mat read #14,r[14],654;sldiv;
		if sldiv<>0
			let div=sldiv
		else
			MAT  READ #2,R1,568;DIV;
		endif
		IF P9$[17,17]="Y" AND GL[3]<>0 AND CLIENT<>0 AND P8$[7,7]="D"
			MAT  READ #13,DIV,76;DIVCLIENT;
			IF DIVCLIENT<>CLIENT GOTO L_2000:
		ENDIF
	Endif
Endif
L_2030: Mat Read #2,R1,0;C1$;
Mat Read #2,R1,142;C1;
MAT READ #14,R[14],0;SHIPNAME$;
mat read #14,r[14],390;SLSLSM;
IF SLSLSM<>0 LET C1[2]=SLSLSM ! set the shipto sales person
mat read #14,r[14],104;ShipST$;
let c1$[136,137]=ShipST$[2,3]
F8 = 99
let k6$=" ",k6$
K6$[1,6] = C1[1] Using "######"
k6$[7,12]= shipcode using "######"
L_2040: Search #34,3,1;K6$,R4,E 
X2 = K6$[1,6]
If E 
	! gosub L_4000:
	Let X2 = -9999
endif
If X2 <> C1[1] ! new customer
	Gosub L_4000  \ Goto L_2000
endif
let x2=k6$[7,12]
if x2<>shipcode
	gosub L_4000\goto L_2000:
endif
If K6$[13,24] < STPROD$ Goto L_2040
If K6$[13,24] > LSTPROD$ Goto L_2040
IF warehs<>0
	let tmp3=k6$[25,26]
	if tmp3<>warehs goto L_2040:
endif
! 
Mat Read #34,R4,0;P$;
If P$ < STPROD$ Goto L_2040
If P$ > LSTPROD$ Goto L_2040
GET_PRODWHSE: REM LOOK UP PROD GROUP
LET Kpw$=" ",Kpw$
LET WHSE=1
LET PARM[2]=1
CHK_WHSE: REM 
IF WHSE>99 goto no_whse
LET Kpw$[1,12]=P$[1,12]                       
LET Kpw$[13,14]=WHSE USING "##" 
SEARCH #ch_pw,2,1;Kpw$,Rec_pw,E 
IF E 
  LET WHSE=WHSE+1 
    GOTO CHK_WHSE 
    ENDIF 
    MAT  READ #ch_pw,Rec_pw,846;WHMISC2; 
    CHK_PRODGRP: REM 
    LET PARM[0]=0 
    LET PARM[1]=WHMISC2[0]  
	Call ProdGroup(e$,intco,Parm[])
    no_whse: !
IF PARM[2]=0 goto L_2040: 
if clflag
	MAT  READ #34,R4,254;WHSE;
	IF P9$[17,17]="Y" AND GL[3]<>0 AND H1=0 AND P8$[7,7]="W" AND CLIENT<>0
		MAT  READ #11,(WHSE-1),844;WHCLIENT;
		IF CLIENT<>WHCLIENT GOTO L_2040:
	ENDIF 
Endif
! remmed was acme - let's use standard!
!	GOSUB L_3800: \ IF F=0 GOSUB L_7000: ! "units conversion (units only)
!	LET T8[0]=0
!	MAT  READ #4,R4,16;Z1; \ MAT  READ #4,R4,256;S5; \ GOSUB L_2500:
!	MAT  READ #4,R4,256;Z2; \ MAT  READ #4,R4,16;S5; \ GOSUB L_2600:
!Else
	Mat Read #34,R4,16;Z1; \ Gosub L_2500
	Mat Read #34,R4,254;WHSE;
	Mat Read #34,R4,256;Z2; \ Gosub L_2600
!Endif
If PRINT_QTY Gosub L_3200
Gosub L_3800 \ If F = 0 Gosub L_7000
T8[0] = 0
For I = 1 To 12
  T8[0] = T8[0] + (S1[I,F] - S2[I,F])
  T8[I] = S1[I,F] - S2[I,F]
Next I
let i1$=" ",i1$
I1$[1,6] = C1[1] Using "######"
let i1$[7,12]=shipcode using "&&&&&&"
i1$[13,16] = "   0"
I1$[17,28] = P$[1,12]

!I = 0
!L_2115: I1$[7,10] = I Using "####"
let i=0
For ctr=0 to maxdept
	let i1$[13,16]=i using "####"
	Search #30,3,1;I1$,R0,E 
	if e<>0
		LPRICE$ = "NONE FOUND" \ LPUM$ = ""	
		goto endlpprice:
	endif
	let tmp3=i1$[1,6]
	if c1[1]<>tmp3 ! customer doesn't match
		LPRICE$ = "NONE FOUND" \ LPUM$ = ""
		goto endlpprice:
	endif
	let tmp3=i1$[7,12]
	if tmp3<>shipcode
			LPRICE$ = "NONE FOUND" \ LPUM$ = ""
		goto endlpprice:
	endif
		
	If i1$[17,28]=p$[1,12] goto getlprecord:
	if i>=maxdept
		LPRICE$ = "NONE FOUND" \ LPUM$ = ""	
		goto endlpprice:	
	endif
	let i=i+1
next ctr
getlprecord: ! get lp record
Mat Read #30,R0,28;LPC2;
Mat Read #30,R0,46;LPC3;
CNVTU[0] = 0;CNVTU[1] = LPC3[3];CNVTU[2] = 2;CNVTA = LPC2[1] \ Gosub L_20000
LPRICE$ = AMOUNT Using "#######.##"
If LPC3[3] > 0 Mat Read #8,LPC3[3],0;CCD$; \ LPUM$ = "/" + CCD$[11,14]
endlpprice: ! end get last price
If DT$ <> "Y" Gosub L_5800
Gosub L_3000
If DT$ <> "Y" Gosub L_5000
Gosub L_2200
Goto L_2040
!
L_2200: Rem TOTALS CALC
For I = 0 To 12
  T9[I,2] = T9[I,2] + T8[I];T7[I,2] = T7[I,2] + T8[I]
  T9[I,0] = T9[I,0] + S1[I,F];T7[I,0] = T7[I,0] + S1[I,F]
  T9[I,1] = T9[I,1] + S2[I,F];T7[I,1] = T7[I,1] + S2[I,F]
  G9[I,2] = G9[I,2] + T8[I] \ G9[I,0] = G9[I,0] + S1[I,F] \ G9[I,1] = G9[I,1] + S2[I,F]
Next I
Return 
!
L_2500: Rem "========================== adjust this year buckets for fiscal year
X7 = BOYMONTH
For I = 0 To 12
  For X6 = 0 To 2
    If I Let S1[I,X6] = Int(Z1[X7,X6] + .5) Else Let S1[0,X6] = Int(Z1[0,X6] + .5)
  Next X6
  If I If X7 = ARMONTH Let I = 13
  If I Let X7 = X7 + 1 \ If X7 = 13 Let X7 = 1
Next I
Return 
!
L_2600: Rem "========================== adjust last year buckets for fiscal year
X7 = BOYMONTH \ X8 = 0
For I = 0 To 12
  For X6 = 0 To 2
    If Not(I) Let S2[0,X6] = Int(Z2[0,X6] + .5) \ Goto L_2640
    If Not(X8) Let S2[I,X6] = Int(Z2[X7,X6] + .5) Else Let S2[I,X6] = Int(Z1[X7,X6] + .5)
L_2640: Next X6
  If I If X7 = ARMONTH Let X8 = 1
  If I Let X7 = X7 + 1 \ If X7 = 13 Let X7 = 1
Next I
Return 
!
L_3000: Rem YEAR YTD,S
Gosub L_3500
For X6 = 1 To 12
  Y9[X6,0] = Y9[X6,0] + S1[X6,F]
  If X6 > 1 Let Y9[X6,0] = Y9[X6,0] + Y9[X6 - 1,0]
  Y9[X6,1] = Y9[X6,1] + S2[X6,F]
  If X6 > 1 Let Y9[X6,1] = Y9[X6,1] + Y9[X6 - 1,1]
  Y9[X6,2] = Y9[X6,0] - Y9[X6,1]
  Y9[X6,3] = Y9[X6,3] + Y9[X6,0]
  Y9[X6,4] = Y9[X6,4] + Y9[X6,1]
  Y9[X6,5] = Y9[X6,5] + Y9[X6,2]
  Y9[X6,6] = Y9[X6,6] + Y9[X6,0]
  Y9[X6,7] = Y9[X6,7] + Y9[X6,1]
  Y9[X6,8] = Y9[X6,8] + Y9[X6,2]
Next X6
Return 
!
L_3200: Rem "=================================== get qoh from whse record
K5$ = " ",K5$ \ For I = 0 To 24 \ W3[I] = 0 \ Next I
K5$[1,12] = P$;K5$[13,14] = WHSE Using "##"
Search #5,2,1;K5$,R5,E 
If Not(E) Mat Read #5,R5,78;W3;
Return 
L_3500: Rem CLEAR
For X6 = 0 To 12
  For Y7 = 0 To 2
    Y9[X6,Y7] = 0
  Next Y7
Next X6
Return 
!
L_3600: Rem "=============================== generic totals print
X7 = 20
For X6 = 1 To 12
  Print #0; Using "--------#"; Tab X7;FNR(Y9[X6,X8]);
  X7 = X7 + 9
Next X6
Return 
!
L_3800: Rem "======================================== get product
Search #3,2,1;P$,R3,E 
If E Let PFU1[9] = -99 \ Goto L_3900
Mat Read #3,R3,0;A$;
Mat Read #3,R3,256;A;
Mat Read #3,R3,512;PFU1;
Mat Read #3,R3,554;PFU2;
L_3900: Return 
!
L_4000: Rem CUSTOMER TOTAL PRINT
if J8 if DT$="N" return ! dx xml, detail format
!
If (Not(Y9[12,3])) And (Not(Y9[12,4])) Goto L_4293
!
if J8
  If F9 
	SHIPName$="*GRAND TOTALS"
	c1[1]=0
	shipcode=0
  else
	!CustName$=rtrim$(C1$[31,60])
  endif
  !
  If X0 = 1 or X0 = 3
	!tmp$=C1[1] Using "######",fdel$,CustName$,fdel$
	tmp$=C1[1] Using "######",fdel$
	tmp$=tmp$,shipcode using "&&&&&&",fdel$
	tmp$=tmp$,SHIPName$,fdel$
    tmp$=tmp$,"THIS YEAR MTD ",J9$,fdel$
    for cnt=1 to 12
      tmp$=tmp$,FNR(T9[cnt,0]) Using "--------##",fdel$
    next cnt
	!  
    call addtostr(e$,rstr$,tmp$+rdel$)
	!
    !tmp$=C1[1] Using "######",fdel$,CustName$,fdel$
	
	tmp$=C1[1] Using "######",fdel$
	tmp$=tmp$,shipcode using "&&&&&&",fdel$
	tmp$=tmp$,SHIPName$,fdel$
	tmp$=tmp$,"THIS YEAR YTD",J9$,fdel$
    for cnt=1 to 12
      tmp$=tmp$,FNR(Y9[cnt,3]) Using "--------##",fdel$
    next cnt
	!  
    call addtostr(e$,rstr$,tmp$+rdel$)
  endif
  !
  if X0 = 2 or X0 = 3
    !tmp$=C1[1] Using "######",fdel$,CustName$,fdel$
	tmp$=C1[1] Using "######",fdel$
	tmp$=tmp$,shipcode using "&&&&&&",fdel$
	tmp$=tmp$,SHIPName$,fdel$
	tmp$=tmp$,"LAST YEAR MTD",J9$,fdel$
    for cnt=1 to 12
      tmp$=tmp$,FNR(T9[cnt,1]) Using "--------##",fdel$
    next cnt
    !
    call addtostr(e$,rstr$,tmp$+rdel$)
	!
    !tmp$=C1[1] Using "######",fdel$,CustName$,fdel$
	tmp$=C1[1] Using "######",fdel$
	tmp$=tmp$,shipcode using "&&&&&&",fdel$
	tmp$=tmp$,SHIPName$,fdel$
	tmp$=tmp$,"LAST YEAR YTD",J9$,fdel$
    for cnt=1 to 12
      tmp$=tmp$,FNR(Y9[cnt,4]) Using "--------##",fdel$
    next cnt
	!  
    call addtostr(e$,rstr$,tmp$+rdel$)
 endif
  !
 if X0 = 3 or X0 = 4
    tmp$=C1[1] Using "######",fdel$
	tmp$=tmp$,shipcode using "&&&&&&",fdel$
	tmp$=tmp$,SHIPName$,fdel$
	tmp$=tmp$,"DIFF. MTD ",J9$,fdel$
    for cnt=1 to 12
      tmp$=tmp$,FNR(T9[cnt,2]) Using "--------##",fdel$
    next cnt
    !
    call addtostr(e$,rstr$,tmp$+rdel$)
    !tmp$=C1[1] Using "######",fdel$,CustName$,fdel$
	tmp$=C1[1] Using "######",fdel$
	tmp$=tmp$,SHIPCODE using "&&&&&&",fdel$
	tmp$=tmp$,SHIPName$,fdel$
	tmp$=tmp$,"DIFF. YTD ",J9$,fdel$
    for cnt=1 to 12
      tmp$=tmp$,FNR(Y9[cnt,5]) Using "--------##",fdel$
    next cnt
	!  
    call addtostr(e$,rstr$,tmp$+rdel$)
  endif
  !
  gosub L_4400 ! clear totals
  return
endif
!
Gosub L_5800
If F9 Print #0;"*GRAND TOTALS" \ J1 = J1 + 1
If Not(F9) 
	Print #0;"*CUSTOMER TOTALS  ";
	Print #0; Using "######";C1[1];".";
	Print #0; using "&&&&&&";SHIPCODE;" ";SHIPNAME$[1,30] \ J1 = J1 + 1
endif
If X0 = 2 Or X0 = 4 Goto L_4095
Print #0; Tab 2;"*THIS YEAR MTD ";J9$; \ F1 = 0
Gosub L_4300
Print #0;" "
J1 = J1 + 1
Print #0; Tab 2;"*THIS YEAR YTD ";J9$; \ X8 = 3
Gosub L_3600
Print #0;" "
J1 = J1 + 1
L_4095: Rem
If X0 = 1 Or X0 = 4 Goto L_4170
Print #0; Tab 2;"*LAST YEAR MTD ";J9$; \ F1 = 1
Gosub L_4300
Print #0;" "
J1 = J1 + 1
Print #0; Tab 2;"*LAST YEAR YTD ";J9$; \ X8 = 4
Gosub L_3600
Print #0;" "
J1 = J1 + 1
L_4170: Rem
If X0 = 1 Or X0 = 2 Goto L_4290
Print #0; Tab 2;"*DIFF. MTD "; \ F1 = 2
Gosub L_4300
Print #0;" "
J1 = J1 + 1
Print #0; Tab 2;"*DIFF. YTD "; \ X8 = 5
Gosub L_3600
Print #0;" "
J1 = J1 + 1
X7 = 20 \ Print #0; Tab 2;"*DIFF. % MTD ";
For X6 = 1 To 12
  If T9[X6,0] Print #0; Using "-------#%"; Tab X7;FNR((T9[X6,2] / T9[X6,0]) * 100);
  If Not(T9[X6,0]) If T9[X6,2] < 0 Print #0; Using "-------#%"; Tab X7;-100;
  If Not(T9[X6,0]) If T9[X6,2] > 0 Print #0; Using "-------#%"; Tab X7;100;
  X7 = X7 + 9
Next X6
Print #0;" "
J1 = J1 + 1
X7 = 20 \ Print #0; Tab 2;"*DIFF. % YTD ";
For X6 = 1 To 12
  If Y9[X6,3] Print #0; Using "-------#%"; Tab X7;FNR((Y9[X6,5] / Y9[X6,3]) * 100);
  If Not(Y9[X6,3]) If Y9[X6,5] < 0 Print #0; Using "-------#%"; Tab X7;-100;
  If Not(Y9[X6,3]) If Y9[X6,5] > 0 Print #0; Using "-------#%"; Tab X7;100;
  X7 = X7 + 9
Next X6
Print #0;""
J1 = J1 + 1
L_4290: Print #0;" "
J1 = J1 + 1
L_4293: Gosub L_4400
Return 
!
L_4300: Rem
Print #0; Using "--------#"; Tab 20;FNR(T9[1,F1]);
Print #0; Using "--------#"; Tab 29;FNR(T9[2,F1]);
Print #0; Using "--------#"; Tab 38;FNR(T9[3,F1]);
Print #0; Using "--------#"; Tab 47;FNR(T9[4,F1]);
Print #0; Using "--------#"; Tab 56;FNR(T9[5,F1]);
Print #0; Using "--------#"; Tab 65;FNR(T9[6,F1]);
Print #0; Using "--------#"; Tab 74;FNR(T9[7,F1]);
Print #0; Using "--------#"; Tab 83;FNR(T9[8,F1]);
Print #0; Using "--------#"; Tab 92;FNR(T9[9,F1]);
Print #0; Using "--------#"; Tab 101;FNR(T9[10,F1]);
Print #0; Using "--------#"; Tab 110;FNR(T9[11,F1]);
Print #0; Using "--------#"; Tab 119;FNR(T9[12,F1]);
Return 
!
L_4400: Rem CLEAR ALL CUSTOMER SUB-TOTALS
For X9 = 0 To 12
  For X7 = 0 To 5
    G8[X9,X7] = G8[X9,X7] + Y9[X9,X7]
    Y9[X9,X7] = 0
    If X7 < 3 Let T9[X9,X7] = 0
  Next X7
Next X9
Return 
!
L_4500: Rem "CATEGORY SUBTOTAL PRINT
if J8 return ! dx xml
!
If (Not(Y9[12,6])) And (Not(Y9[12,7])) Goto L_4595
If BREAK$[1,3] = "   " Goto L_4597
Gosub L_5800
Print #0;"*CATGY ";BREAK$[1,3];" TOTALS" \ J1 = J1 + 1
If X0 = 2 Or X0 = 4 Goto L_4531
Print #0; Tab 2;"*THIS YEAR MTD ";J9$; \ F1 = 0
Gosub L_4600
Print #0;" "
J1 = J1 + 1
Print #0; Tab 2;"*THIS YEAR YTD ";J9$; \ X8 = 6
Gosub L_3600
Print #0;" "
J1 = J1 + 1
L_4531: Rem
If X0 = 1 Or X0 = 4 Goto L_4547
Print #0; Tab 2;"*LAST YEAR MTD ";J9$; \ F1 = 1
Gosub L_4600
Print #0;" "
J1 = J1 + 1
Print #0; Tab 2;"*LAST YEAR YTD ";J9$; \ X8 = 7
Gosub L_3600
Print #0;" "
J1 = J1 + 1
L_4547: Rem
If X0 = 1 Or X0 = 2 Goto L_4592
Print #0; Tab 2;"*DIFF. MTD "; \ F1 = 2
Gosub L_4600
Print #0;" "
J1 = J1 + 1
Print #0; Tab 2;"*DIFF. YTD "; \ X8 = 8
Gosub L_3600
Print #0;" "
J1 = J1 + 1
X7 = 20 \ Print #0; Tab 2;"*DIFF. % MTD ";
For X6 = 1 To 12
  If T7[X6,0] Print #0; Using "-------#%"; Tab X7;FNR((T7[X6,2] / T7[X6,0]) * 100);
  If Not(T7[X6,0]) If T7[X6,2] < 0 Print #0; Using "-------#%"; Tab X7;-100;
  If Not(T7[X6,0]) If T7[X6,2] > 0 Print #0; Using "-------#%"; Tab X7;100;
  X7 = X7 + 9
Next X6
Print #0;" "
J1 = J1 + 1
X7 = 20 \ Print #0; Tab 2;"*DIFF. % YTD ";
For X6 = 1 To 12
  If Y9[X6,6] Print #0; Using "-------#%"; Tab X7;FNR((Y9[X6,8] / Y9[X6,6]) * 100);
  If Not(Y9[X6,6]) If Y9[X6,8] < 0 Print #0; Using "-------#%"; Tab X7;-100;
  If Not(Y9[X6,6]) If Y9[X6,8] > 0 Print #0; Using "-------#%"; Tab X7;100;
  X7 = X7 + 9
Next X6
Print #0;" "
J1 = J1 + 1
L_4592: Print #0;""
Print #0;""
J1 = J1 + 2
L_4595: Gosub L_4800
L_4597: Return 
!
L_4600: Rem
Print #0; Using "--------#"; Tab 20;FNR(T7[1,F1]);
Print #0; Using "--------#"; Tab 29;FNR(T7[2,F1]);
Print #0; Using "--------#"; Tab 38;FNR(T7[3,F1]);
Print #0; Using "--------#"; Tab 47;FNR(T7[4,F1]);
Print #0; Using "--------#"; Tab 56;FNR(T7[5,F1]);
Print #0; Using "--------#"; Tab 65;FNR(T7[6,F1]);
Print #0; Using "--------#"; Tab 74;FNR(T7[7,F1]);
Print #0; Using "--------#"; Tab 83;FNR(T7[8,F1]);
Print #0; Using "--------#"; Tab 92;FNR(T7[9,F1]);
Print #0; Using "--------#"; Tab 101;FNR(T7[10,F1]);
Print #0; Using "--------#"; Tab 110;FNR(T7[11,F1]);
Print #0; Using "--------#"; Tab 119;FNR(T7[12,F1]);
Return 
!
L_4700: Rem "========================================= swap
F9 = 999
For X9 = 0 To 12
  For X7 = 0 To 5
    If X7 < 3 Let T9[X9,X7] = G9[X9,X7]
    Y9[X9,X7] = G8[X9,X7]
  Next X7
Next X9
Return 
!
L_4800: Rem CLEAR CATEGORY SUBS
For X9 = 0 To 12
  For X7 = 6 To 8
    Y9[X9,X7] = 0
  Next X7
Next X9
For X9 = 0 To 12
  For X7 = 0 To 2
    T7[X9,X7] = 0
  Next X7
Next X9
Return 
!
L_5000: Rem "===================================== print line
if J8 if DT$="Y" return ! dx xml, cust totals only
!
if J8 ! dx xml
  CustName$=rtrim$(C1$[31,60])
  ProdDesc$=rtrim$(A$[9,38])
  ProdDesc2$=rtrim$(A$[63,92]) \ if P9$[26,26]<>"Y" ProdDesc2$=""
  !
  If X0 = 1 or X0 =3
    tmp$=C1[1] Using "######",fdel$
	tmp$=tmp$,shipcode using "&&&&&&",fdel$
	tmp$=tmp$,ShipName$,fdel$
    tmp$=tmp$,C1$[136,137],fdel$,C1[2] using "###",fdel$
    tmp$=tmp$,P$,fdel$,ProdDesc$,fdel$,ProdDesc2$,fdel$
    tmp$=tmp$,WHSE using "###",fdel$
	If custom_customer$ <> "JPAPER"
			tmp$=tmp$,LPRICE$ + LPUM$,fdel$
	endif
    If PRINT_QTY let tmp$=tmp$,W3[0] - W3[2] Using "-------.##/",SELLUM$,fdel$ 
    tmp$=tmp$,"THIS YEAR MTD ",J9$,fdel$
	for cnt=1 to 12
	  tmp$=tmp$,FNR(S1[cnt,F]) Using "--------#",fdel$
	next cnt
    call addtostr(e$,rstr$,tmp$+rdel$)
    !
    !tmp$=C1[1] Using "######",fdel$,CustName$,fdel$
	tmp$=C1[1] Using "######",fdel$
	tmp$=tmp$,shipcode using "&&&&&&",fdel$
	tmp$=tmp$,ShipName$,fdel$
    tmp$=tmp$,C1$[136,137],fdel$,C1[2] using "###",fdel$
    tmp$=tmp$,P$,fdel$,ProdDesc$,fdel$,ProdDesc2$,fdel$
    tmp$=tmp$,WHSE using "###",fdel$
		If custom_customer$ <> "JPAPER"
			tmp$=tmp$,LPRICE$ + LPUM$,fdel$
	endif
    If PRINT_QTY let tmp$=tmp$,W3[0] - W3[2] Using "-------.##/",SELLUM$,fdel$ 
    tmp$=tmp$,"THIS YEAR YTD ",J9$,fdel$
    for cnt=1 to 12
	  tmp$=tmp$,FNR(Y9[cnt,0]) Using "--------#",fdel$
	next cnt
    call addtostr(e$,rstr$,tmp$+rdel$)
  endif
  !
  If X0 = 2 or X0 = 3 
    !tmp$=C1[1] Using "######",fdel$,CustName$,fdel$
	tmp$=C1[1] Using "######",fdel$
	tmp$=tmp$,shipcode using "&&&&&&",fdel$
	tmp$=tmp$,ShipName$,fdel$
    tmp$=tmp$,C1$[136,137],fdel$,C1[2] using "###",fdel$
    tmp$=tmp$,P$,fdel$,ProdDesc$,fdel$,ProdDesc2$,fdel$
    tmp$=tmp$,WHSE using "###",fdel$
	If custom_customer$ <> "JPAPER"
			tmp$=tmp$,LPRICE$ + LPUM$,fdel$
	endif
	tmp$=tmp$,"LAST YEAR MTD ",J9$,fdel$
	for cnt=1 to 12
	  tmp$=tmp$,S2[cnt,F] Using "--------#",fdel$
	next cnt
    call addtostr(e$,rstr$,tmp$+rdel$)
	!
    !tmp$=C1[1] Using "######",fdel$,CustName$,fdel$
	tmp$=C1[1] Using "######",fdel$
	tmp$=tmp$,shipcode using "&&&&&&",fdel$
	tmp$=tmp$,ShipName$,fdel$
    tmp$=tmp$,C1$[136,137],fdel$,C1[2] using "###",fdel$
    tmp$=tmp$,P$,fdel$,ProdDesc$,fdel$,ProdDesc2$,fdel$
    tmp$=tmp$,WHSE using "###",fdel$
	If custom_customer$ <> "JPAPER"
		tmp$=tmp$,LPRICE$ + LPUM$,fdel$
	endif
    tmp$=tmp$,"LAST YEAR YTD ",J9$,fdel$
    for cnt=1 to 12
	  tmp$=tmp$,Y9[cnt,1] Using "--------#",fdel$
	next cnt
    call addtostr(e$,rstr$,tmp$+rdel$)
  endif
  !
  If X0 = 3 or X0 = 4 
    !tmp$=C1[1] Using "######",fdel$,CustName$,fdel$
	tmp$=C1[1] Using "######",fdel$
	tmp$=tmp$,shipcode using "&&&&&&",fdel$
	tmp$=tmp$,ShipName$,fdel$
    tmp$=tmp$,C1$[136,137],fdel$,C1[2] using "###",fdel$
    tmp$=tmp$,P$,fdel$,ProdDesc$,fdel$,ProdDesc2$,fdel$
    tmp$=tmp$,WHSE using "###",fdel$
	If custom_customer$ <> "JPAPER"
		tmp$=tmp$,LPRICE$ + LPUM$,fdel$
	endif
	tmp$=tmp$,"DIFF. MTD ",J9$,fdel$
	for cnt=1 to 12
	  tmp$=tmp$,T8[cnt] Using "--------#",fdel$
	next cnt
    call addtostr(e$,rstr$,tmp$+rdel$)
	!
    !tmp$=C1[1] Using "######",fdel$,CustName$,fdel$
	tmp$=C1[1] Using "######",fdel$
	tmp$=tmp$,shipcode using "&&&&&&",fdel$
	tmp$=tmp$,ShipName$,fdel$
    tmp$=tmp$,C1$[136,137],fdel$,C1[2] using "###",fdel$
    tmp$=tmp$,P$,fdel$,ProdDesc$,fdel$,ProdDesc2$,fdel$
    tmp$=tmp$,WHSE using "###",fdel$
	If custom_customer$ <> "JPAPER"
		tmp$=tmp$,LPRICE$ + LPUM$,fdel$
	endif
    tmp$=tmp$,"DIFF. YTD ",J9$,fdel$
    for cnt=1 to 12
	  tmp$=tmp$,Y9[cnt,2] Using "--------#",fdel$
	next cnt
    call addtostr(e$,rstr$,tmp$+rdel$)
    !
    !tmp$=C1[1] Using "######",fdel$,CustName$,fdel$
	tmp$=C1[1] Using "######",fdel$
	tmp$=tmp$,shipcode using "&&&&&&",fdel$
	tmp$=tmp$,ShipName$,fdel$
    tmp$=tmp$,C1$[136,137],fdel$,C1[2] using "###",fdel$
    tmp$=tmp$,P$,fdel$,ProdDesc$,fdel$,ProdDesc2$,fdel$
    tmp$=tmp$,WHSE using "###",fdel$
	If custom_customer$ <> "JPAPER"
		tmp$=tmp$,LPRICE$ + LPUM$,fdel$
	endif
	tmp$=tmp$,"DIFF. % MTD ",fdel$
    For X6 = 1 To 12
      If S2[X6,F] 
		let tmp$=tmp$,(T8[X6] / S2[X6,F]) * 100 Using "---#%",fdel$
	  else
		select case s1[x6,f]
		case is < 0 
			let tmp$=tmp$,0 - 100 Using "---#%",fdel$
		case is > 0 
			let tmp$=tmp$,0 + 100 Using "---#%",fdel$
		case else
			let tmp$=tmp$,fdel$
		end select
	  endif
    Next X6
    call addtostr(e$,rstr$,tmp$+rdel$)
	!
	!tmp$=C1[1] Using "######",fdel$,CustName$,fdel$
	tmp$=C1[1] Using "######",fdel$
	tmp$=tmp$,shipcode using "&&&&&&",fdel$
	tmp$=tmp$,ShipName$,fdel$
    tmp$=tmp$,C1$[136,137],fdel$,C1[2] using "###",fdel$
    tmp$=tmp$,P$,fdel$,ProdDesc$,fdel$,ProdDesc2$,fdel$
    tmp$=tmp$,WHSE using "###",fdel$
	If custom_customer$ <> "JPAPER"
		tmp$=tmp$,LPRICE$ + LPUM$,fdel$
	endif
    tmp$=tmp$,"DIFF. % YTD ",fdel$
    For X6 = 1 To 12
		If Y9[X6,1] 
			let tmp$=tmp$,(Y9[X6,2] / Y9[X6,1]) * 100 Using "---#%",fdel$
		else
			select case y9[x6,0]
			case is > 0 
				let tmp$=tmp$,0 + 100 Using "---#%",fdel$
			case is < 0 
				let tmp$=tmp$,0 - 100 Using "---#%",fdel$
			case else
				let tmp$=tmp$,fdel$
			end select
		endif
    Next X6
    call addtostr(e$,rstr$,tmp$+rdel$)
  endif
  return
endif
!
If F8 = 0 Goto L_5020
Print #0; Using "######";C1[1];".";
print #0; using "&&&&&&";shipcode;
Print #0; Tab 14;Shipname$[1,25];" ";C1$[136,137];
If Not(SLSM) Print #0; Using "###";"    SALESMAN: ";C1[2] Else Print #0;""
J1 = J1 + 1
L_5020: Print #0; Tab 0;"PROD: ";P$;" ";A$[9,38];
If P9$[26,26] = "Y" Print #0;" ";A$[63,92];
Print #0;" WHSE: ";WHSE;
if custom_customer$="JPAPER"
	print #0;"" ! do not print last price info
else
	Print #0; Tab (95);"LAST PRICE: ";LPRICE$ + LPUM$
endif
J1 = J1 + 1
If X0 = 2 Or X0 = 4 Goto L_5120
If PRINT_QTY If F = 0
  Print #0; Tab 3;"QTY AVAIL.";
  Print #0; Using "-------.##/"; Tab 1;W3[0] - W3[2];SELLUM$ \ J1 = J1 + 1
End If 
Print #0; Tab 2;"THIS YEAR MTD ";J9$;
Print #0; Using "--------#"; Tab 20;FNR(S1[1,F]);
Print #0; Using "--------#"; Tab 29;FNR(S1[2,F]);
Print #0; Using "--------#"; Tab 38;FNR(S1[3,F]);
Print #0; Using "--------#"; Tab 47;FNR(S1[4,F]);
Print #0; Using "--------#"; Tab 56;FNR(S1[5,F]);
Print #0; Using "--------#"; Tab 65;FNR(S1[6,F]);
Print #0; Using "--------#"; Tab 74;FNR(S1[7,F]);
Print #0; Using "--------#"; Tab 83;FNR(S1[8,F]);
Print #0; Using "--------#"; Tab 92;FNR(S1[9,F]);
Print #0; Using "--------#"; Tab 101;FNR(S1[10,F]);
Print #0; Using "--------#"; Tab 110;FNR(S1[11,F]);
Print #0; Using "--------#"; Tab 119;FNR(S1[12,F])
J1 = J1 + 1
Print #0; Tab 2;"THIS YEAR YTD ";J9$;
X8 = 0 \ Gosub L_3600
Print #0;" "
J1 = J1 + 1
L_5120: Rem
If X0 = 1 Or X0 = 4 Goto L_5215
Print #0; Tab 2;"LAST YEAR MTD ";J9$;
Print #0; Using "--------#"; Tab 20;FNR(S2[1,F]);
Print #0; Using "--------#"; Tab 29;FNR(S2[2,F]);
Print #0; Using "--------#"; Tab 38;FNR(S2[3,F]);
Print #0; Using "--------#"; Tab 47;FNR(S2[4,F]);
Print #0; Using "--------#"; Tab 56;FNR(S2[5,F]);
Print #0; Using "--------#"; Tab 65;FNR(S2[6,F]);
Print #0; Using "--------#"; Tab 74;FNR(S2[7,F]);
Print #0; Using "--------#"; Tab 83;FNR(S2[8,F]);
Print #0; Using "--------#"; Tab 92;FNR(S2[9,F]);
Print #0; Using "--------#"; Tab 101;FNR(S2[10,F]);
Print #0; Using "--------#"; Tab 110;FNR(S2[11,F]);
Print #0; Using "--------#"; Tab 119;FNR(S2[12,F])
J1 = J1 + 1
Print #0; Tab 2;"LAST YEAR YTD ";J9$;
X8 = 1 \ Gosub L_3600
Print #0;" "
J1 = J1 + 1
L_5215: If X0 = 1 Or X0 = 2 Goto L_5380
Print #0; Tab 2;"DIFF. MTD ";J9$;
Print #0; Using "--------#"; Tab 20;FNR(T8[1]);
Print #0; Using "--------#"; Tab 29;FNR(T8[2]);
Print #0; Using "--------#"; Tab 38;FNR(T8[3]);
Print #0; Using "--------#"; Tab 47;FNR(T8[4]);
Print #0; Using "--------#"; Tab 56;FNR(T8[5]);
Print #0; Using "--------#"; Tab 65;FNR(T8[6]);
Print #0; Using "--------#"; Tab 74;FNR(T8[7]);
Print #0; Using "--------#"; Tab 83;FNR(T8[8]);
Print #0; Using "--------#"; Tab 92;FNR(T8[9]);
Print #0; Using "--------#"; Tab 101;FNR(T8[10]);
Print #0; Using "--------#"; Tab 110;FNR(T8[11]);
Print #0; Using "--------#"; Tab 119;FNR(T8[12])
J1 = J1 + 1
Print #0; Tab 2;"DIFF. YTD ";J9$;
X8 = 2 \ Gosub L_3600
Print #0;" "
J1 = J1 + 1
X7 = 20 \ Print #0; Tab 2;"DIFF. % MTD ";
For X6 = 1 To 12
  If S2[X6,F] Print #0; Using "-------#%"; Tab X7;FNR((T8[X6] / S2[X6,F]) * 100);
  If Not(S2[X6,F]) If S1[X6,F] < 0 Print #0; Using "-------#%"; Tab X7;-100;
  If Not(S2[X6,F]) If S1[X6,F] > 0 Print #0; Using "-------#%"; Tab X7;100;
  X7 = X7 + 9
Next X6
Print #0;" "
J1 = J1 + 1
X7 = 20 \ Print #0; Tab 2;"DIFF. % YTD ";
For X6 = 1 To 12
  If Y9[X6,0] Print #0; Using "-------#%"; Tab X7;FNR((Y9[X6,2] / Y9[X6,0]) * 100);
  If Not(Y9[X6,0]) If Y9[X6,2] < 0 Print #0; Using "-------#%"; Tab X7;-100;
  If Not(Y9[X6,0]) If Y9[X6,2] > 0 Print #0; Using "-------#%"; Tab X7;100;
  X7 = X7 + 9
Next X6
Print #0;" "
J1 = J1 + 1
L_5380: Print #0;" "
J1 = J1 + 1
If X0 = 3 And PRINT_QTY And F = 0 Print #0;" " \ J1 = J1 + 1
F8 = 0
Return 
!
L_5800: Rem "====================================== headings
if J8 return ! dx xml
!
If J1 + L9 < J9 Return 
! - If J2 If J8 Input @0,23;"PRESS <CR> TO CONTINUE "J$ \ Print 'CS';
If J2 If Not(J8) Print #0;"\14\";
J2 = J2 + 1 \ J1 = 0
If Not(J8) Print #0;" " \ J1 = J1 + 1
F8 = 99
Print #0; Tab 10;ARDATE$; Tab (64 - Len(CNAME$) / 2);CNAME$; Tab 120;"PAGE";J2
j1=j1+1
if clflag
IF CLIENT PRINT #0; USING " #### "; TAB 50;"CLIENT: ";CLIENT;GL$[11,50];
IF MONTH1<>GL2[0] PRINT #0; TAB 100;"YEAR END: ";MONTH1
j1=j1+1
Endif
Print #0;" - 454spb - ";Msc$(3);
Print #0; Tab 50;"SHIP TO CUSTOMER 12 MONTH SALES REPORT"
Print #0; Tab 53;TITLE$
J1 = J1 + 3
If SLSM<>0 OR WAREHS<>0
	Print #0; Using "###"; Tab 20;"FOR SALESMAN # ";SLSM;
	PRINT #0; TAB 70;"WAREHOUSE ";WAREHS;
	PRINT #0;""
	J1 = J1 + 1
ENDIF
Print #0;" "
Print #0; ;"CUST SHIPTO";
Print #0; Tab 14;"NAME";
Print #0; Tab 26;
For I = 1 To 12
  Print #0;MTH$[I * 3 - 2,I * 3];"      ";
Next I
Print #0;" "
Print #0;" "
J1 = J1 + 3
Return 
!
L_6300: REM SET UP FMONTH (EACH HOLD MONTH# 1-24)            
FOR X=0 TO 25 \ LET FMONTH[X]=X \ NEXT X                     
LET X7=BOYMONTH;X8=0;X9=0                                    
FOR I=1 TO 12                                                
  IF NOT (X9) LET FMONTH[I]=X7 ELSE  LET FMONTH[I]=0-X7        
  IF NOT (X8) LET FMONTH[I+13]=X7+13 ELSE  LET FMONTH[I+13]=X7 
  If X7 = M9 Let X8 = 1;X9 = 1
  LET X7=X7+1 \ IF X7=13 LET X7=1                            
NEXT I  
Return
!
L_7000: Rem CONVERT UNITS
If PFU1[9] = -99 Goto L_7090
For I = 0 To 12
  CNVTU[0] = 0;CNVTU[1] = PFU1[9];CNVTU[2] = 1;CNVTA = S1[I,0]
  Gosub L_20000 \ S1[I,0] = AMOUNT
Next I
For I = 0 To 12
  CNVTU[0] = 0;CNVTU[1] = PFU1[9];CNVTU[2] = 1;CNVTA = S2[I,0]
  Gosub L_20000 \ S2[I,0] = AMOUNT
Next I
L_7090: For I = 0 To 2
  CNVTU[0] = 0;CNVTU[1] = PFU1[9];CNVTU[2] = 1;CNVTA = W3[I]
  Gosub L_20000 \ W3[I] = AMOUNT
Next I
If PFU1[9] = -1 Let SELLUM$ = "CWT "
If PFU1[9] = -3 Let SELLUM$ = "LB  "
If PFU1[9] > 0 Mat Read #8,PFU1[9],0;CCD$; \ SELLUM$ = CCD$[11,14]
Return 
!
OUTEND: Rem EXIT ROUTINE
! dx close
if j8 !dx xml
 call addtostr(e$,rstr$,esdel$) !end section
 !!!!!!print rstr$
  call setoutput(e$,rstr$,1) !1 flag puts 0 status seciton in, puts </page> in
end if
!
end
!
! - L_9010: Print 'CS'
! - Chain "MX000C"
! 
L_9100: Rem END OF THIS RANGE
If CHAN = 9 Gosub L_4500 ! category break
Gosub L_4000
Gosub L_4700 
Gosub L_4000
! - If J8 Print @0,23;"PRESS <CR> TO CONTINUE ";'CL'; \ Input ""J$
Goto OUTEND
!
L_20000: Rem UNIT CONVERSION RETURNS AMOUNT  (rev 01/07/1992)   ! 20040 REM
If CNVTU[2] = 3 Goto L_20050
If CNVTU[2] = 1 And CNVTU[1] = CNVTU[0] Let AMOUNT = CNVTA \ Goto L_20160
If CNVTU[0] = -2 Or CNVTU[1] = -2 Let AMOUNT = CNVTA \ Goto L_20160
If CNVTU[2] = 0 Goto L_20050
If Not(CNVTA) Let AMOUNT = 0 \ Goto L_20160
L_20050: goto L_20120 ! dx change  If Spc(4) > 1280 Goto L_20120
Swap 1,"MXPRCONV"
If CNVTU[2] = 3 Goto L_20160
L_20080: Signal 2,X1,AMOUNT,FLAG ! - If X1 = -1 Let E = 0 \ Gosub ERR_SEARCH
If X1 <> Spc(6) Goto L_20080
If CNVTU[2] = 0 Goto L_20160
! - If FLAG Let E = FLAG \ Gosub ERR_SEARCH
Goto L_20160
L_20120: Rem "====== unibasic 5+ logic
Call "MXPRCONV5",PFU1[],PFU2[],A[],CNVTU[],CNVTA,SC,SR,FLAG
If CNVTU[2] = 0 Goto L_20160
! - If FLAG Let E = FLAG \ Gosub ERR_SEARCH
AMOUNT = CNVTA
L_20160: Return 
!
Rem {begin rtn.error.s}
ERR_TRAP: Rem *Error routine (escape trap)   V3.1 8/94 G.DOSCHER/REK
!
! dx replace entire error routine
include "src/callmainerrnet.inc"
end
