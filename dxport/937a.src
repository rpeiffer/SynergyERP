! >>> Program 937a
!
! description Invoice Journal
!
! loadsave -w -n 100,10 -o prog/dxport/937a.dl4 src/937a.src
!
! 1.0 mm/dd/yyyy change??
!
include "src/copyright.inc" ! dx
!
External Lib "librebates.lib"
Declare External Sub rebates
!
Rem BEDIT Version: 2.2 OBJECT CODE     Created: FEB  9, 2006  15:30:00
Rem /w2/papermaster/r2005//usr/acct/txc/work/r2005/ut/mu937a.src (univ2) [txc] {04756}
Rem  Copyright (c) 2006 Universal Business Systems, Inc.
Rem    **** ALL CHANGES MUST BE MADE IN SOURCE!!! ****
Rem
Rem "MU937A   -- MONTHLY Invoice Journal
Rem "Author   -- Roman Sawycky
Rem "Date     -- 01/02/1990
! 04/25/11 - ADD TOTO - (TOTALS ONLY) - NO XML AS doesn't print them!
!
Declare Intrinsic Sub DateToJulian,FindF,InpBuf,String,VerifyDate
!!Option Default Dialect IRIS1
Com 1%,PFU1[20],CNVTU[2],UN[2]
Com 2%,S9[4]
Com 3%,PFU2[6],CNVTA,A[33]
If Err 0 Gosub ERR_TRAP
Def FNR(X) = Sgn(X) * (Int(Abs(X) * 100 + .5) * .01)
Dim 1%,E,F,F9,H4[2],I,J2,J8,J9,L3[3],TYPE[1],P1,S2,S7,W0,X,X1
Dim 1%,BWH[99],BDV[99],BTYP[40],COSTFLAG,JSDETL,CPSAME
Dim 1%,SORT,PASS,OLS2[1],POS_,DETAIL,REC,GLDET,COSTCHG,EUN[2]
Dim 1%,LOCKPORT,DL1,FLAG,COID,OT19Part,TOTO,2%,D3[1]
Dim 2%,D9[5],H0[12],H5[16],L4[3],L6[5],3%,R1,R5,R6,R11,R17,2%,W1,X2,N1,CSH0[4],SP
Dim 2%,SLSM[9],JRNL,I_CTR,Q0[1],DIV,DL[12],H6[8],PRODB[24]
Dim 2%,C1[12],SHDate[5]
Dim 3%,J,L5[3],T2[25],T4[4],T5[4],T6[4],T7[13],T9[20],T16[8],OLM[6]
Dim K35$[20],1%,JTL[2],JTL2,3%,JTL1[11],R[35],OREF[5],N0,j1
Dim 3%,SUNIT[3],PUNIT,SUNIT$[4],PUNIT$[4],UNITX,UNIT$[4],CUNIT,CUNIT$[4]
Dim 3%,T10[7],T11[2],CAT[19,5],TOTCOM
Dim 3%,X3,L7[12],L7$[6],S3[17],CSH1[2],SLSMS1[3],SCOM[4],SMER[4],SCST[4]
Dim 3%,PRPARC[3],WHMISC[6],COST3,NETPOCOST,RBCOST,K7$[30]
Dim 3%,TT2[25],AMOUNT,EX[18],TTOT[14],CFIN[8],W3[24],LDCOST,GT[10],UNF[6]
Dim C1$[30],C2$[30],S1$[118],D1$[8],D9$[10],F1$[16],J$[40],CNAME$[30]
Dim J2$[20],J3$[40],ARDATE$[8],K1$[50],K2$[40],K3$[20],L6$[60],DT$[50]
Dim S$[25],K11$[40],S2$[30],K6$[50],PMASK$[15],SNK$[50],SN1$[54],TFLE$[40]
Dim N1$[25],CCTYPE$[100],K35$[20],A$[80],DL$[20],DL1$[20],I$[50],CSH0$[156],D$[20]
Dim L1$[20],P0$[20],P1$[156],P9$[50],P60$[50],X$[14],Z1$[50],AR_MTH$[4],3%
Dim X1$[14],j1$[30]
Dim K17$[30],1%,JTL[2],JTL2,3%,JTL1[11],JTTL[11],INVNET,TOTNET,TOTFCST
Dim 3%,X14,EXTOTCOST,EXTCOST,X14$[40],P61$[256],KEY_$[50],FILENAME$[16],TOTCOST,T0
Dim 1%,STATUS,3%,REBATE_ARGS[10,4],REC_PROD,REC_PRWH,comd
Dim 3%
Dim tmp$[1500],tmp1$[500],tmp2$[100]
Dim action$[30],options$[30],userid$[8],b$[200],3%,fdel$[10],rstr$[500],bsdel$[10],esdel$[10],rdel$[10]
!
Dim e$[500],buttonlist$[5,50],nextlist$[5,100] ! dx error handling variables
dim Blank$[50] \ Blank$=" ",Blank$
dim EndParam$[50] \ EndParam$="z",EndParam$
!
For J = 2 To 22
  Read J0 \ If J0 = -1 Goto L_830
  J2 = Abs(Fra(J0) * 1000) \ If J2 <= 88 Or J2 > Chf(1) - 1 Let J2 = 88
  J1 = Int(Abs(J0))
  Read #1,J2,J1;J$;
  If J0 < 0 Ropen #J,J$ Else Open #J,J$
L_830: Next J
Data "-1136","-1152","-1168","-1184","-1808","-1792","-2256","-1","-2704","-1824","-1728","-1","-1"
Data "-1","-1","-1744","-1"," -1120"," -304"," -1"," -320"
Gosub L_6800
Read #1,20,42;N1;
Mat Read #1,0,100;ARDATE$;
Mat Read #1,115,0;D9;
Mat Read #1,19,50;P9$;
Mat Read #1,60,50;P60$;
Mat Read #1,61,0;P61$;
Read #1,3;CNAME$;
Mat Read #1,49,0;CCTYPE$;
Read #1,150,0;J$;
!
! - COID = Int((Spc(5) - Int(Spc(5) / 16384) * 16384) / 64)
! - X14$ = "4/SORDFLEHHKEY" + Str$(COID)
! - Open #18,X14$
! - FILENAME$ = "4/invarchindx" + Str$(COID)
! - Call FindF(FILENAME$,Y)
! - If Y And P61$[28,28] = "Y" Let ARCHEXIST = 1
!
Read #1,88,800;F1$;
Mat Read #1,115,40;Q0; \ If Q0[1] <= 0 Let Q0[1] = 2
PMASK$ = "##########"
X = Len(PMASK$) - Q0[1] \ If X < 0 Let X = Q0[1]
PMASK$[X,X] = "."
W0 = D9[5]
Dim 3%,T8[W0,6],COMM[W0,2],3%
If Err 0 Let J8 = Spc(8)
J8 = 0 \ J9 = Chf(0)
If Err 0 Gosub ERR_TRAP
If J8 If J8 <> 49 Gosub ERR_TRAP
J9 = 55 \ If J8 Let J9 = 20
S2 = 7
MULTIS = 0 \ If P9$[21,21] = "Y" Let MULTIS = 1
JTL2 = 0; toto=0
!
! - I$ = " ",I$ \ I$ = "[1:64] 6/JSDTMP";I$[Len(I$) + 1] = Spc(6) Using "&&&&","!"
! - Build #35,I$
! - R[35] = 4 \ Search #35,0,1;I$,R[35],E !!\ If E Gosub ERR_SEARCH
! - R[35] = 1 \ Search #35,0,0;I$,R[35],E !!\ If E Gosub ERR_SEARCH
!
Call getsession(e$,CTLC,options$,action$,userid$,intCO,intSls,fdel$,rstr$,bsdel$,esdel$,rdel$)
!
If J8 ! dx xml, setup rstr$
  !<section>
  tmp$ = bsdel$,"937a",fdel$,rdel$
  Call addtostr(e$,rstr$,tmp$)
End If 
!
X14$ = "4/SORDFLEHHKEY" + Str$(intCO)
Open #18,X14$
FILENAME$ = "4/invarchindx" + Str$(intCO)
Call FindF(FILENAME$,Y)
If Y And P61$[28,28] = "Y" Let ARCHEXIST = 1
Read #1,88,800;F1$;
!
I$ = "[1:64] 6/JSDTMP",rtrim$(UserId$),"!"
Build #35,I$
R[35] = 4 
Search #35,0,1;I$,R[35],E 
if E let e$="Can't build ",I$,"!" \ error 10000
R[35] = 1
Search #35,0,0;I$,R[35],E 
if E let e$="Can't build ",I$,"!" \ error 10000
!
call dxsave(0,"tmp/937in.txt!")
call dxget("I0",K2$)  !!MONTHLY (C)REDIT OR (I)NVOICE REGISTER OR (B)OTH
call dxget("I1",tmp$) \ X = tmp$ !!MMYY
call dxget("I2",tmp$) \ If tmp$ = "E" Let F8 = 0 else Let F8 = 99 !!(E)NTIRE A/R MONTH OR PRINT A (J)OURNAL? ";
If tmp$="D" let F8=0;HDater=1 ! date range
call dxget("I3",tmp$) \ F7 = tmp$ !! ENTER THE JOURNAL NUMBER TO PRINT? ";######
call dxget("I4",tmp$) \ P1 = tmp$ !! TYPE: 1=CASH  2=ORDERS  3=BOTH  E=EXIT  "
call dxget("I5",tmp$) \ W1 = tmp$
call dxget("I6",tmp$) \ DIV = tmp$ 
call dxget("I7",tmp$) \ SORT = tmp$ !! PRINT: 1=INVOICE JOURNAL, 2=SALESPERSON JOURNAL, 3=BOTH
call dxget("I8",tmp$) \ if tmp$ = "" Let PRTSCOST = 0 else Let PRTSCOST = 1 !PRINT COST & G/P ON SALESPERSON JOURNAL? (Y/N/E)
call dxget("I9",tmp$) \ if tmp$ = "S" Let DETAIL = 0 else Let DETAIL = 99 !PRINT JOURNAL IN (D)ETAIL OR (S)UMMARY
If tmp$="T" let DETAIL=0;TOTO=1
call dxget("I10",tmp$) \ if tmp$ = "S" Let LNDETL = 0 else Let LNDETL = 99 !"PRINT INVOICE LINES IN (D)ETAIL OR (S)UMMARY
call dxget("I11",tmp$) \ if tmp$ = "" Let CPSAME = 0 else Let CPSAME = 1 !PRINT COST IN SAME U/M AS PRICE? (Y/N/E)  
call dxget("I12",tmp$) \ COSTFLAG = tmp$ !RINT COST OPTION: 1=GL  2=LOAD  3=REBATE/NET PO  4=REBATE/GL 
call dxget("I13",tmp$) \ if tmp$ = "" Let JSDETL = 0 else Let JSDETL = 99 !PRINT Whse/Div/Order Type SUMMARY TOTALS PAGE? (Y/N
call dxget("I14",tmp1$)
if HDater ! history date range
	call dxget("SDate",tmp$) ! comes in as MMDDYY!
	j1=tmp$
	if j1<=0 ! no default here
		e$="Please enter a starting date!" \ error 10000
	Else
		x$=J1 using "&&&&&&"
		tmp$=x$[5,6]+X$[1,4] ! now YYMMDD
		j1=tmp$
		tmp$=j1 Using "&&&&&&"
		Call DateToJulian(1,tmp$,tmp2$,F)
		If F let E$="INVALID START DATE!" \ ERROR 1000
		sHDATE=TMP2$
	Endif
	call dxget("EDate",tmp$) ! comes in as MMDDYY!
	j1=tmp$
	if j1<=0 ! no default here
		e$="Please enter an ending date!" \ error 10000
	Else
		x$=J1 using "&&&&&&"
		tmp$=x$[5,6]+X$[1,4] ! now YYMMDD
		j1=tmp$
		tmp$=j1 Using "&&&&&&"
		Call DateToJulian(1,tmp$,tmp2$,F)
		If F let E$="INVALID END DATE!" \ ERROR 10000
		sHDATE[1]=TMP2$
	Endif
	if shdate[1]<shdate[0]
		e$="Invalid date range!" \ error 10000
	endif
Endif
!
! totals only validdate - can't be xml!
if toto=1 and j8
	e$="Can not run totals only to the browser!" \ error 10000
Endif
!validation division
if DIV < 0 or DIV > 99 Let e$ = "Invalid division, must be between 0 and 99!" \ error 10000
!
!validation warehouse
if W1 < 0 or W1 > D9[5] Let e$ = "Invalid warehouse, must be between 0 and ",D9[5],"!" \ error 10000
!
! type
if P1 = 3 Let P1 = 0 
TYPE = P1 \ TYPE[1] = P1
!
! monthly register
If K2$ = "B" Let S7 = 39
If K2$ = "C" Let S7 = 31
If K2$ = "I" Let S7 = 30
!
!validation date
! If F8=0 and not(HDater) ! ALWAYS REQUIRED!
	X$ = X Using "####"
	AR_MTH$[1,4] = X$[1,4]
	M8 = X$[1,2] \ M9 = X$[3,4]
	If M8 < 1 Or M8 > 12 Let E$ = "Invalid date!" \ error 10000
	if  M9 < 0 Or M9 > 99 Let E$ = "Invalid date!" \ error 10000
	X$[1,2] = M9 Using "&&" \ X$[3,4] = M8 Using "&&"
	X2 = X$[1,4] \ Gosub L_7900 \ JSDT = X2
! Endif
!
If ARCHEXIST
  KEY_$ = JSDT Using "&&&&&&"
  Close #18
  X14$ = "4/invarchindx" + Str$(intCO)
  Ropen #18,X14$
SEARCHARCHIVE: Rem
  Search #18,3,1;KEY_$,R18,E !!\ If E > 2 Gosub ERR_SEARCH
  MOYR = KEY_$[1,6];STAT = KEY_$[7,8]
  If MOYR < JSDT Goto SEARCHARCHIVE
  If MOYR = JSDT ! " and stat=s7
    If (S7 <> 39 And STAT = S7) Or (S7 = 39 And STAT <> 0)
WHATTOPRINT: Rem
      !!Print @0,4;'CE';"PRINT FROM (H)ISTORY OR (A)RCHIVE? ";
      !!Input Len 16384 + 1;""K2$ \ Call String(1,K2$)
	  K2$ = tmp1$
      If K2$ = "" Goto WHATTOPRINT
      Call String(1,K2$)
      If K2$ <> "H" And K2$ <> "A" Goto WHATTOPRINT
      If K2$ = "A"
        Close #2,#3,#4,#5,#10
        Ropen #2,"4/sordflehh" + X$[3,4] + Str$(intCo)
        Ropen #3,"4/sordflesh" + X$[3,4] + Str$(intCo)
        Ropen #4,"4/sordfleth" + X$[3,4] + Str$(intCo)
        Ropen #5,"4/sordflelh" + X$[3,4] + Str$(intCo)
        Ropen #10,"4/sordcashh" + X$[3,4] + Str$(intCo)
        Goto ENDSEARCH
      End If 
    End If 
  End If 
  Gosub OPENHISTFILE
End If
ENDSEARCH:
!
If F8 Let N1$ = F7 Using "REPRINT OF JOURNAL ######"
!
Read #1,18,30;D9$;
!
N = SORT \ PASS = 1
If SORT < 3 Let PASS = 0 else Let SORT = 1 
!
If PASS = 0 And SORT = 1 Let PRTSCOST = 0
!
If Not(DETAIL) Let LNDETL = 0 \ CPSAME = 0
If Not(LNDETL) Let CPSAME = 0
!
!!L_1000: Rem "================================================ inputs
!!Print 'CS';@0,0;"MU937A";@25,0;"MONTHLY INVOICE/CREDIT JOURNAL"
!!L_1005: Rem "Journal type
!!Print @0,2;"MONTHLY (C)REDIT OR (I)NVOICE REGISTER OR (B)OTH  (E)XIT? ";'CE';
!!S7 = 0 \ Input Len 16384 + 1;""K2$ \ Call String(1,K2$)
!!If K2$ = "E" Goto OUTEND
!!If K2$ = "B" Let S7 = 39
!!If K2$ = "C" Let S7 = 31
!!If K2$ = "I" Let S7 = 30
!!If Not(S7) Goto L_1000
!!L_1035: Rem "journal date
!!Print @0,3;'CE';"ENTER A/R MONTH CODE FOR JOURNAL (MMYY) ";
!!Input Len 16384 + 4;""X$ \ If X$ = "" Goto L_1005
!!If Len(X$) < 3 Or Len(X$) > 4 Goto L_1035
!!X = X$;X$ = X Using "####"
!!AR_MTH$[1,4] = X$[1,4]
!!M8 = X$[1,2];M9 = X$[3,4]
!!If M8 < 1 Or M8 > 12 Or M9 < 0 Or M9 > 99 Goto L_1035
!!X$[1,2] = M9 Using "&&";X$[3,4] = M8 Using "&&"
!!X2 = X$[1,4] \ Gosub L_7900 \ JSDT = X2
!!
!!If ARCHEXIST
!!  KEY_$ = JSDT Using "&&&&&&"
!!  Close #18
!!  X14$ = "4/invarchindx" + Str$(intCo)
!!  Ropen #18,X14$
!!SEARCHARCHIVE: Rem
!!  Search #18,3,1;KEY_$,R18,E !!\ If E > 2 Gosub ERR_SEARCH
!!  MOYR = KEY_$[1,6];STAT = KEY_$[7,8]
!!  If MOYR < JSDT Goto SEARCHARCHIVE
!!  If MOYR = JSDT ! " and stat=s7
!!    If (S7 <> 39 And STAT = S7) Or (S7 = 39 And STAT <> 0)
!!WHATTOPRINT: Rem
!!      !!Print @0,4;'CE';"PRINT FROM (H)ISTORY OR (A)RCHIVE? ";
!!      !!Input Len 16384 + 1;""K2$ \ Call String(1,K2$)
!!      If K2$ = "" Goto WHATTOPRINT
!!      Call String(1,K2$)
!!      If K2$ <> "H" And K2$ <> "A" Goto WHATTOPRINT
!!      If K2$ = "A"
!!        Close #2,#3,#4,#5,#10
!!        Ropen #2,"4/sordflehh" + X$[3,4] + Str$(COID)
!!        Ropen #3,"4/sordflesh" + X$[3,4] + Str$(COID)
!!        Ropen #4,"4/sordfleth" + X$[3,4] + Str$(COID)
!!        Ropen #5,"4/sordflelh" + X$[3,4] + Str$(COID)
!!        Ropen #10,"4/sordcashh" + X$[3,4] + Str$(COID)
!!        Goto ENDSEARCH
!!      End If 
!!    End If 
!!  End If 
!!  Gosub OPENHISTFILE
!!End If
!!ENDSEARCH: Rem
!!L_1065: Print @0,5;'CE';"PRINT (E)NTIRE A/R MONTH OR PRINT A (J)OURNAL? ";
!!F8 = 0 \ Input Len 16384 + 1;""K2$ \ Call String(1,K2$)
!!If K2$ = "" Goto L_1035
!!If K2$ = "J" Let F8 = 99
!!If K2$ <> "E" And K2$ <> "J" Goto L_1065
!!If Not(F8) Goto L_1120
!!If S7 = 39 Print @0,6;'CE';"ENTER THE JOURNAL NUMBER TO PRINT? ";
!!If S7 = 30 Print @0,6;'CE';"ENTER INVOICE JOURNAL NUMBER TO PRINT? ";
!!If S7 = 31 Print @0,6;'CE';"ENTER CREDIT JOURNAL NUMBER TO PRINT? ";
!!Input Len 16384 + 6;""K2$
!!F7 = K2$
!!If Not(F7) Goto L_1065
!!Goto L_1120
!!L_1120: Print @0,8;'CE';
!!Print "TYPE: 1=CASH  2=ORDERS  3=BOTH  E=EXIT  ";
!!Input Len 16384 + 1;""K1$ \ Call String(1,K1$)
!!If K1$ = "E" Goto OUTEND
!!If F8 Let N1$ = F7 Using "REPRINT OF JOURNAL ######"
!!If Len(K1$) <> 1 Goto L_1120 Else Let P1 = K1$
!!If Fra(P1) Or P1 < 1 Or P1 > 3 Goto L_1120
!!If P1 = 3 Let P1 = 0
!!TYPE = P1;TYPE[1] = P1
!!L_1160: Rem "====== which warehouse(s) to print
!!If D9[5] = 1 Let W1 = 0 \ Goto L_1195
!!Read #1,18,30;D9$;
!!Print @0,10;'CE';"ENTER ";D9$;" #  0:all  E:exit   ";
!!Input Len 16384 + 2;""K1$ \ Call String(1,K1$)
!!If K1$ = "E" Goto OUTEND
!!If Len(K1$) > 2 Goto L_1160 Else Let W1 = K1$
!!If Fra(W1) Or W1 < 0 Or W1 > D9[5] Goto L_1160
!!L_1195: Rem "========= which division(s) to print
!!Print @0,12;'CE';"ENTER DIVISION #  0:all  E:exit   ";
!!Input Len 16384 + 2;""K1$ \ Call String(1,K1$)
!!If K1$ = "E" Goto OUTEND
!!If Len(K1$) > 2 Goto L_1195 Else Let DIV = K1$
!!If Fra(DIV) Or DIV < 0 Or DIV > 99 Goto L_1195
!!L_1220:!! Print @0,13;'CE';"PRINT: 1=INVOICE JOURNAL, 2=SALESPERSON JOURNAL, 3=BOTH, E=EXIT ";
!!Input Len 16384 + 1;""K1$ \ Call String(1,K1$)
!!If K1$ = "E" Goto OUTEND
!!If Len(K1$) > 1 Goto L_1220 Else Let SORT = K1$ \ N = K1$
!!If Fra(SORT) Or SORT < 1 Or SORT > 3 Goto L_1220
!!If SORT < 3 Let PASS = 0 \ Goto L_1250
!!SORT = 1 \ PASS = 1
!!L_1250: If PASS = 0 And SORT = 1 Goto L_1280
!!L_1255: Print @0,14;'CE';"PRINT COST & G/P ON SALESPERSON JOURNAL? (Y/N/E)   ";
!!Input Len 16384 + 1;""DT$ \ Call String(1,DT$)
!!If DT$ = "E" Goto OUTEND
!!If DT$ <> "Y" If DT$ <> "N" Goto L_1255
!!PRTSCOST = 0
!!If DT$ = "Y" Let PRTSCOST = 1
!!L_1280: Print @0,15;'CE';"PRINT JOURNAL IN (D)ETAIL OR (S)UMMARY, OR  E:exit  ";
!!Input Len 16384 + 1;""DT$ \ Call String(1,DT$)
!!If DT$ = "E" Goto OUTEND
!!If DT$ = "S" Let DETAIL = 0
!!If DT$ = "D" Let DETAIL = 99
!!If DT$ <> "S" And DT$ <> "D" Goto L_1280
!!If Not(DETAIL) Goto L_1340
!!L_1310: Print @0,16;'CE';"PRINT INVOICE LINES IN (D)ETAIL OR (S)UMMARY, OR  E:exit   ";
!!Input Len 16384 + 1;""DT$ \ Call String(1,DT$)
!!If DT$ = "E" Goto OUTEND
!!If DT$ = "S" Let LNDETL = 0
!!If DT$ = "D" Let LNDETL = 99
!!If DT$ <> "S" And DT$ <> "D" Goto L_1310
!!L_1320: Rem "Cost & Price Same U/M?
!!If LNDETL ! "only if detail
!!  Print @0,17;'CE';"PRINT COST IN SAME U/M AS PRICE? (Y/N/E)  ";
!!  Input Len 16384 + 1;""DT$ \ Call String(1,DT$)
!!  If DT$ = "E" Goto OUTEND
!!  If DT$ <> "Y" And DT$ <> "N" Goto L_1320
!!  CPSAME = 0
!!  If DT$ = "Y" Let CPSAME = 1
!!Else 
!!  Print @0,17;'CE';"PRINT COST IN SAME U/M AS PRICE?  N/A  ";
!!  CPSAME = 0
!!End If 
!!L_1340: Rem "all versions   IF SORT=2 GOTO L_1351:
!!Print @0,18;'CE';"PRINT COST OPTION: 1=GL  2=LOAD  3=REBATE/NET PO  4=REBATE/GL   E=EXIT ";
!!Input Len (16384 + 1);""K1$
!!Call String(1,K1$)
!!If K1$ = "E" Goto OUTEND
!!COSTFLAG = K1$ \ If Fra(COSTFLAG) Or COSTFLAG < 1 Or COSTFLAG > 4 Goto L_1340
!!If COSTFLAG = 3
!!  Print @0,19;"Rebate/Net Po Cost are Generated as of the time this report is Printed ";
!!Else 
!!  If COSTFLAG = 4
!!    Print @0,19;"Rebate Cost are generated as of the time this report is printed ";
!!  Else 
!!    Print @0,19;'CL';
!!  End If 
!!End If 
!!L_1351: Rem order type
!!L_1352: Print @0,20;'CE';"PRINT Whse/Div/Order Type SUMMARY TOTALS PAGE? (Y/N) ";
!!Input Len 16384 + 1;""DT$ \ Call String(1,DT$)
!!If DT$ = "E" Goto OUTEND
!!If DT$ <> "Y" If DT$ <> "N" Goto L_1352
!!JSDETL = 0 \ If DT$ = "Y" Let JSDETL = 99
!!L_1370: Rem "==ok
!!Print @0,22;'CE';"CHOOSE  P:print  R:reselect all  E:exit ";
!!Input Len 16384 + 1;""Z1$ \ Call String(1,Z1$)
!!If Z1$ = "E" Goto OUTEND
!!If Z1$ = "R" Goto L_1000
!!If Z1$ <> "P" Goto L_1370
!!Goto STARTJRNL
If J8 = 0 !if pdf or print, new method, after edits,setouput,dxclose
  Call setoutput(e$,rstr$,2) !2 flag puts 0 status section in w/print in process msg, puts </page> in
End If
!
STARTJRNL: Rem "================================================ clear all tot's
L_1405:
!! Print @0,23;'CL';"Clearing Totals..."; \ Signal 3,0
For J = 0 To 25
  T2[J] = 0
  If J < 14 Let T7[J] = 0
  If J < 21 Let T9[J] = 0
  If J < 8 Let T10[J] = 0
  If J < 3 Let T11[J] = 0
  If J < 15 Let TTOT[J] = 0
  If J < 9 Let T16[J] = 0
  If J < 5 Let T4[J] = 0;T5[J] = 0;T6[J] = 0
Next J
For J = 0 To D9[5]
  For J1 = 0 To 6
    If J1 < 7 Let T8[J,J1] = 0
    If J1 < 3 Let COMM[J,J1] = 0
  Next J1
Next J
For J = 0 To 999 !!\ If Not(Fra(J / 50)) Print ".";
  REC = J \ Gosub L_6750
Next J
SLSMTDGP = 0;SLSYTDGP = 0;SLSMTDSL = 0;SLSYTDSL = 0
TOTNET = 0;TOTFCST = 0
Gosub L_8800
!!Print @0,22;'CE';"Sorting...please wait"; \ Signal 3,0
K1$ = " ",K1$
Search #9,3,1;K1$,R1,E 
If E Goto L_1550
Goto L_1900
!
L_1550: Rem "=========================================== sort invoices
K1$ = " ",K1$;K1$[1,6] = JSDT Using "&&&&&&";K1$[7,8] = S7 Using "&&"
If S7 = 39 Let K1$[7,8] = "30"
K3$ = K1$
L_1570: 
Search #18,3,1;K1$,R1,E 
If E Goto L_1900
If S7 <> 39 And K1$[1,8] <> K3$[1,8] Goto L_1900
If S7 = 39 And K1$[1,6] <> K3$[1,6] Goto L_1900
KEY_$ = " ",KEY_$ \ KEY_$ = K1$[7,18]
Search #2,2,1;KEY_$,R1,E 
Mat Read #2,R1;H0;
Mat Read #2,R1,78;H4;
Mat Read #2,R1,104;H5; \ Mat Read #2,R1,278;SLSM;
Mat Read #2,R1,512;OREF;
Mat Read #4,OREF[5],8;T2;
Mat Read #4,OREF[5],164;JRNL;
If H5[7] = 12 Goto L_1570
If W1 If W1 <> H4[2] Goto L_1570
If TYPE = 0 Goto L_1598
If F8 If JRNL <> F7 Goto L_1570
If P1 = 1 If T2[10] = 0 Goto L_1570
If P1 = 2 If T2[10] <> 0 Goto L_1570
L_1598: 
If DIV If DIV <> H5[8] Goto L_1570
if HDater ! wants a date range of accepted dates?
	x$=T2[25] using "&&&&&&&&" ! yymmddaa - a=armonth
	tmp$=x$[1,6] ! cut to yymmdd
	Call DateToJulian(1,tmp$,tmp2$,F)
	if f let tmp2$="00000"
	let JDate=tmp2$
	if jdate<shdate[0] goto L_1570 ! too low
	if jdate>shdate[1] goto L_1570 ! too high
Endif
K2$ = " ",K2$
K2$ = OREF[1] Using "&&&&&&&&&&";K2$[11] = H0[7] Using "##########"
If H0 = 31 Let K2$ = H0[7] Using "&&&&&&&&&&";K2$[11] = OREF[1] Using "##########"
K2$[21,21] = "A"
Search #9,4,1;K2$,R1,E 
If E Let e$ = "syserrorfile 937a sortfile mode (m)=4 keyno (k)=1 r=",R1," e=",e," keyval (k$)=",K2$ \ error 10000
K2$ = " ",K2$;TSRT = 0
K2$[1,1] = "#";K2$[2,4] = H0[11] Using "###"
If MULTIS
  For X = 0 To 4 \ If SLSM[X] = 0 Goto L_1657
    TSRT = 1
    K2$[2,4] = SLSM[X] Using "###" \ Gosub L_1660
L_1657: Next X \ If TSRT = 0 Goto L_1660
  TSRT = 0 \ Goto L_1690
End If 
L_1660: 
K2$[5] = OREF[1] Using "##########";K2$[15] = H0[7] Using "##########"
If H0 = 31 Let K2$[5] = H0[7] Using "##########";K2$[15] = OREF[1] Using "##########"
K2$[25,25] = "A"
Search #9,4,1;K2$,R1,E 
If E Let e$ = "syserrorfile 937a sortfile mode (m)=4 keyno (k)=1 r=",R1," e=",e," keyval (k$)=",K2$ \ error 10000
If TSRT = 1 If MULTIS Return 
L_1690: Goto L_1570
!
L_1900: Rem "========================================= start print
If J8
  If DETAIL
    tmp$ = "INV #",fdel$,"ORD #",fdel$,"ORD TYPE",fdel$
    tmp$ = tmp$, "DATE",fdel$,"CUST CODE",fdel$,"NAME",fdel$
    tmp$ = tmp$, "PO NUMBER",fdel$,"SHIPPED TO",fdel$,"TKN BY",fdel$
    tmp$ = tmp$, "SLSM CODE",fdel$,"SLSM NAME",fdel$,"COMMN S/C",fdel$
	!
    If LNDETL
      tmp$ = tmp$, "LIN",fdel$,"ITEM CODE",fdel$,"DESCRIPTION 1",fdel$,"DESCRIPTION 2",fdel$
      tmp$ = tmp$, "ORDERED",fdel$,"B'ORD",fdel$,"SHIPPED",fdel$
      tmp$ = tmp$, "U/M",fdel$,"PRICE",fdel$,"PRICE TYPE",fdel$
      If SORT <> 2 or PRTSCOST
        If COSTFLAG = 1 Let tmp$ = tmp$, "G/L COST",fdel$
        If COSTFLAG = 2 Let tmp$ = tmp$, "LOAD COST",fdel$
        If COSTFLAG = 3 Let tmp$ = tmp$, "RB/NET COST",fdel$
        If COSTFLAG = 4 Let tmp$ = tmp$, " RB/GL COST",fdel$
        tmp$ = tmp$, "COST U/M",fdel$
		If COSTFLAG <>2 Let tmp$ = tmp$, "C",fdel$
		tmp$ = tmp$,"EXT COST",fdel$
      End if
      tmp$ = tmp$, "EXT PRICE",fdel$
  	  If SORT <> 2 Or PRTSCOST
        tmp$ = tmp$, "G PROFIT",fdel$,"G PROFIT%",fdel$
        tmp$ = tmp$, "C PROFIT",fdel$
      End if
      tmp$ = tmp$, "COM%",fdel$,"COMM$",fdel$
      If S3[0] Let tmp$ = tmp$,"CUTTING CHARGE",fdel$
      If SORT <> 2 Or PRTSCOST
        If S3[1] Let tmp$ = tmp$, "CUTTING COST",fdel$
      End if
    Else
      tmp$ = tmp$, "LIN",fdel$,"ITEM CODE",fdel$,"DESCRIPTION",fdel$
      tmp$ = tmp$, "SHIPPED",fdel$
      tmp$ = tmp$, "EXT PRICE",fdel$
      If SORT <> 2 Or PRTSCOST
        tmp$ = tmp$, "EXT COST",fdel$,"G PROFIT",fdel$
        tmp$ = tmp$, "PCT",fdel$,"C PROFIT",fdel$
  	  End if
      tmp$ = tmp$, "COM%",fdel$,"COMM $",fdel$
    End if
  Else
    tmp$ = "INV",fdel$,"CUSTOMER CODE",fdel$,"CUSTOMER NAME",fdel$
	tmp$ = tmp$,"ORD #",fdel$,"AMOUNT",fdel$,"TAX",fdel$
	tmp$ = tmp$,"FREIGHT",fdel$,"MISC",fdel$,"TOTAL AMOUNT",fdel$
    If SORT <> 2 Or PRTSCOST
      tmp$ = tmp$, "TOTAL"
      If COSTFLAG = 1 Let tmp$ = tmp$, " G/L"
      If COSTFLAG = 2 Let tmp$ = tmp$, " LOAD"
      If COSTFLAG = 3 Let tmp$ = tmp$, " RB/NET"
      If COSTFLAG = 4 Let tmp$ = tmp$, " RB/GL"
      tmp$ = tmp$," COST",fdel$,"GROSS PROFIT",fdel$
      tmp$ = tmp$,"PROFIT %",fdel$
	End if
	tmp$ = tmp$,"COMM AMT",fdel$,"OT",fdel$
  End if
  call addtostr(e$,rstr$,tmp$+rdel$)
End if
comd = 0 \ tmp1$ = "" 
!
!!Print @0,22;'CE';"Printing...please wait"; \ Signal 3,0
!!If J8 Print 'CS';
J2 = 0;J1 = 90
P1 = TYPE \ If P1 <= 0 Let P1 = 1
If PASS = 0 Let TYPE = 9
L_1940: !!If Err 0 Gosub ERR_ESCAPE
If SORT = 1 Let POS_ = 21
If SORT = 2 Let POS_ = 25
K1$ = "# " \ SP = 9999
If SORT = 1 Let K1$[1,2] = "#}"
I_CTR = 0
L_2000: Rem "===================================== main invoice loop here!
L_2005: 
Search #9,3,1;K1$,R1,E 
If E Goto L_9100
If SORT = 2 If K1$[1,1] <> "#" Goto L_9100
If K1$[1,1] = "''" Goto L_2005
If K1$[POS_,POS_] = "D" Goto L_2000
Mat Read #2,R1,0;H0
Mat Read #2,r1,508;OT19Part;
Mat Read #2,R1,512;OREF
Mat Read #4,OREF[5],8;T2;
If P1 = 1 If T2[10] = 0 Goto L_2000
If P1 = 2 If T2[10] <> 0 Goto L_2000
If SORT = 2 If MULTIS Gosub L_3500
If SP <> H0[11] And SP <> 9999 Gosub L_4800
SP = H0[11] \ Gosub L_10000
Mat Read #2,R1,446;P0$
Mat Read #2,R1,78;H4
Mat Read #2,R1,104;H5
Mat Read #2,R1,278;SLSM
Mat Read #2,R1,318;SCOM
Mat Read #2,R1,348;SMER
Mat Read #2,R1,378;SCST
Mat Read #2,R1,408;H6
N0 = OREF[1] \ If H0[0] = 31 Let N0 = H0[7]
W0 = H4[2]
Mat Read #3,OREF[4],8;S1$
Read #4,OREF[5],164;JRNL;
If F8 If JRNL <> F7 Goto L_2000
Mat Read #4,OREF[5],8;T2;
If S7 = 39 And H0[0] = 31 ! " credits in BOTH journal - reverse totals
  H5[13] = 0 - H5[13];H5[14] = 0 - H5[14]
  For X = 0 To 4
    SCOM[X] = 0 - SCOM[X];SMER[X] = 0 - SMER[X]
    SCST[X] = 0 - SCST[X]
  Next X
  H6[6] = 0 - H6[6]
  For X = 0 To 25
    If X <> 2 And X <> 21 And X <> 23 And X <> 25 ! "not valid for reversal
      T2[X] = 0 - T2[X]
    End If 
  Next X
End If 
T2[1] = T2[1] - H6[6];T2[5] = T2[5] + H6[6]
Gosub L_8000
Gosub L_6600
T2[4] = T2[4] + T2[6]
X2 = H0[8] \ Gosub L_7700 \ D1$ = X$
TOTCOM = 0
For X = 0 To 4 \ TOTCOM = TOTCOM + SCOM[X] \ Next X
Gosub L_3000 \ Gosub L_3200
Gosub L_5800
If DETAIL 
	Gosub L_5000
Else 
	If toto=0 Gosub L_5700 Else let I_CTR = I_CTR + 1
Endif
Gosub L_2200
If DETAIL Gosub L_4500
If DETAIL Gosub L_5200
Gosub L_2500
Goto L_2000
!
L_2200: Rem "=========================== journal totals calc
If H5[7]=19 And OT19Part Return ! "no totals on these!
TOT = 0 \ If SORT = 2 If MULTIS Gosub L_2400
For J = 0 To 5
  If TOT = 1 Goto L_2220
  If J = 1 Let T11[J] = T11[J] + (H5[13] - EXTOTCOST)
  If J = 2 Let T11[J] = T11[J] + TOTCOM
L_2220: If J = 2 Goto L_2240
  T9[J] = T9[J] + T2[J]
  If TOT = 0 Let T10[J] = T10[J] + T2[J]
L_2240: Next J
T9[2] = T9[2] + T2[7]
If TOT = 0 Let TOTCOST = TOTCOST + EXTOTCOST
If TOT = 0 Let T10[2] = T10[2] + T2[7]
If TOT = 0 Let T10[6] = T10[6] + (H5[13] - EXTOTCOST)
If TOT = 0 Let T10[7] = T10[7] + TOTCOM
If T2[10] <= 0 Goto L_2310
If CSH0[2] = 0 Goto L_2310
If T2[10] > 3 Goto L_2310
REC = H5[0] \ Gosub L_6700
If CSH0[2] Let T6[CSH0[2] - 1] = T6[CSH0[2] - 1] + CSH1[0]
If CSH0[3] Let T6[CSH0[3] - 1] = T6[CSH0[3] - 1] + CSH1[1]
T6[4] = T6[4] + T2[0]
T5[CSH0[2] - 1] = T5[CSH0[2] - 1] + T2[0]
If T2[12] >= T2[0] Goto L_2300
T4[CSH0[2] - 1] = T4[CSH0[2] - 1] + (T2[0] - (CSH1[0] + CSH1[1]))
L_2300: REC = H5[0] \ Gosub L_6750
L_2310: Rem
INVNET = FNR((H5[13] - EXTOTCOST) - (H5[13] * CFIN[8] / 100))
If TOT = 0 Let TOTNET = TOTNET + INVNET
If TOT = 0 Let TOTFCST = TOTFCST + T2[20]
Return 
!
L_2360: Rem ENT'D BY TOTALS
If H5[7]=19 And OT19Part Return ! "no totals on these!
REC = H5[0] \ Gosub L_6700
For J = 0 To 5
  If J = 2 Let T16[J] = T16[J] + T2[7] \ Goto L_2380
  T16[J] = T16[J] + T2[J]
L_2380: Next J
T16[6] = T16[6] + EXTOTCOST
T16[7] = T16[7] + 1
REC = H5[0] \ Gosub L_6750
Return 
!
L_2400: Rem MULTI-REP TOTALS
If H5[7]=19 And OT19Part Return ! "no totals on these!
TOT = 0 \ If SLMN = -1 Return 
T10[0] = T10[0] + SMER[SLMN];T10[1] = T10[1] + SMER[SLMN]
T11[1] = T11[1] + (SMER[SLMN] - SCST[SLMN])
T11[2] = T11[2] + SCOM[SLMN]
T10[6] = T10[6] + (SMER[SLMN] - SCST[SLMN]);T10[7] = T10[7] + SCOM[SLMN]
TOTCOST = TOTCOST + SCST[SLMN]
TOT = 1 \ Return
!
L_2500: Rem "=========================================== add to wh totals
If H5[7]=19 And OT19Part Return ! "no totals on these!
If SORT <> 2 Or Not(MULTIS) Goto L_2530
Z1$ = " ",Z1$;Z1$ = "''",K1$[5,24]
Search #9,2,1;Z1$,J,E 
If Not(E) Goto L_2590
Search #9,4,1;Z1$,J,E 
If E Let e$ = "syserrorfile 937a sortfile mode (m)=4 keyno (k)=1 r=",J," e=",e," keyval (k$)=",Z1$ \error 10000
L_2530: 
For J = 0 To 5
  If J = 1 Let COMM[0,J] = COMM[0,J] + (H5[13] - EXTOTCOST)
  If J = 1 Let COMM[W0,J] = COMM[W0,J] + (H5[13] - EXTOTCOST)
  If J = 2 Let COMM[0,J] = COMM[0,J] + TOTCOM
  If J = 2 Let COMM[W0,J] = COMM[W0,J] + TOTCOM
  If J = 2 Let T8[0,J] = T8[0,J] + T2[7]
  If J = 2 Let T8[W0,J] = T8[W0,J] + T2[7] \ Goto L_2570
  T8[0,J] = T8[0,J] + T2[J] \ T8[W0,J] = T8[W0,J] + T2[J]
L_2570: Next J
T8[0,6] = T8[0,6] + (H5[13] - EXTOTCOST) \ T8[W0,6] = T8[W0,6] + (H5[13] - EXTOTCOST)
Gosub L_2360
Gosub L_2600
L_2590: Return 
!
L_2600: Rem WH/DIV/TYPE TOTALS
If H5[7]=19 And OT19Part Return ! "no totals on these!
If Not(JSDETL) Return 
K35$ = " ",K35$;K35$[1,2] = JTL2 Using "##"
K35$[3,4] = H4[2] Using "##";K35$[5,6] = H5[8] Using "##";K35$[7,8] = H5[7] Using "##"
Search #35,2,1;K35$,R[35],E 
If E = 0 Goto L_2700
E = 2
Search #35,1,0;K35$,R[35],E 
If E Let e$ = "syserrorfile 937a jsdtmp sortfile mode (m)=1 keyno (k)=0 r=",R[35]," e=",e," keyval (k$)=",K35$ \ error 10000
Search #35,4,1;K35$,R[35],E 
If E Let e$ = "syserrorfile 937a jsdtmp sortfile mode (m)=4 keyno (k)=1 r=",R[35]," e=",e," keyval (k$)=",K35$ \ error 10000
For X = 0 To 11
  JTL1[X] = 0 \ If X <= 2 Let JTL[X] = 0
Next X
JTL[0] = H4[2];JTL[1] = H5[8];JTL[2] = H5[7]
Mat Write #35,R[35],0;JTL
Mat Write #35,R[35],6;JTL1
Mat Write #35,R[35],78;JTL2
L_2700: Rem TOTAL ROUTINE
NUMLINES = 0
J2$ = " ",J2$;J2$[1,10] = N0 Using "##########"
L_2715: 
Search #5,3,1;J2$,R5,E 
If E = 2 Goto L_2740
X3 = J2$[1,10] \ If X3 <> N0 Goto L_2740
NUMLINES = NUMLINES + 1
Goto L_2715
!
L_2740: 
Mat Read #35,R[35],6;JTL1
For J = 0 To 5
  If J = 2 Let JTL1[J] = JTL1[J] + T2[7] \ Goto L_2760
  JTL1[J] = JTL1[J] + T2[J]
L_2760: Next J
JTL1[6] = JTL1[6] + T2[17];JTL1[7] = JTL1[7] + T2[15]
JTL1[8] = JTL1[8] + T2[16]
If COSTFLAG <> 2 ! "was SORT<>2 AND COSTFLAG=1
  JTL1[9] = JTL1[9] + (T2[1] - EXTOTCOST)
Else ! for gl cost or rebate/net cost
  JTL1[9] = JTL1[9] + (H5[13] - EXTOTCOST)
End If 
JTL1[10] = JTL1[10] + 1;JTL1[11] = JTL1[11] + NUMLINES
Mat Write #35,R[35],6;JTL1;
BWH[W0] = 1;BDV[H5[8]] = 1;BTYP[H5[7]] = 1
If W0 > HWH Let HWH = W0
If H5[8] > HDV Let HDV = H5[8]
If H5[7] > HOTP Let HOTP = H5[7]
Return 
!
L_3000: Rem "======================================== read customer name
J3$ = " ",J3$ \ J3$ = H0[4] Using "######"
Search #6,2,1;J3$,R6,E
If K1$[POS_,POS_] = "D" If E Let C1$ = "CUSTOMER NOT ON FILE !!!! " \ Return 
Mat Read #6,R6,142;C1;
Mat Read #6,R6,30;C1$;
Mat Read #6,R6,544;CFIN;
Return 
L_3200: Rem "======================================== read bill to
J3$ = " ",J3$ \ J3$ = H0[1] Using "######"
Search #6,2,1;J3$,R6,E 
!!If E If H0[1] = H0[4] Gosub ERR_SEARCH
If E If H0[1] <> H0[4] Let H0[1] = H0[4] \ Goto L_3200
Mat Read #6,R6,30;C2$;
Return 
!
L_3500: Rem MULTI SLSM RTN
If SORT <> 2 If Not(MULTIS) Return 
SLMN = -1;X2 = K1$[2,4]
Mat Read #2,R1,278;SLSM
For X = 0 To 4 \ If SLSM[X] = 0 Goto L_3540
  If X2 = SLSM[X] Let SLMN = X
L_3540: Next X
If SLMN = -1 Return 
If SLSM[SLMN] <> 0 Let H0[11] = SLSM[SLMN]
Return 
!
L_3600: Rem PRINT SLSM SUMMARY
If H5[7]=19 And OT19Part Return ! "no totals on these!
If SLMN = -1 Return 1
!
If J8
  tmp$ = tmp$, SMER[SLMN] Using "-----#.##",fdel$
  tmp$ = tmp$, SMER[SLMN] Using "------#.##",fdel$
  If SORT = 2 If PRTSCOST 
    tmp$ = tmp$, SCST[SLMN] Using "------#.##",fdel$
	tmp$ = tmp$, SMER[SLMN] - SCST[SLMN] Using "------#.##",fdel$
  End if
  If SORT <> 2 Or PRTSCOST
    If SMER[SLMN] 
	  tmp$ = tmp$, ((SMER[SLMN] - SCST[SLMN]) / SMER[SLMN]) * 100 Using " ---.-",fdel$
	Else
	  tmp$ = tmp$,"",fdel$
	End if
  End if
  tmp$ = tmp$, SCOM[SLMN] Using "-----#.##",fdel$
  Return
End if
!
Print #0; Using "-----#.##"; Tab 46;SMER[SLMN];
Print #0; Using "------#.## "; Tab 83;SMER[SLMN];
If SORT = 2 If PRTSCOST Print #0; Using "------#.## ";SCST[SLMN];SMER[SLMN] - SCST[SLMN];
If SORT = 2 If Not(PRTSCOST) Goto L_3650
If SMER[SLMN] Print #0; Using " ---.-"; Tab 115;((SMER[SLMN] - SCST[SLMN]) / SMER[SLMN]) * 100;
L_3650: Print #0; Using "-----#.##"; Tab 122;SCOM[SLMN];
Return 
!
L_3700: Rem MULTI-REP INV TOTALS
If H5[7]=19 And OT19Part Return 1 ! "no totals on these!
If SLMN = -1 Return 1
If SORT <> 2 Return 1
!
If J8 Return
If H0[0] = 30 Print #0; Using "INVOICE ######## TOTALS: "; Tab 8;OREF[1];
If H0[0] = 31 Print #0; Using "CREDIT  ######## TOTALS: "; Tab 8;H0[7];
X$ = "-----#.##";X1$ = "------#.##" \ If J1 + 6 >= J9 Let J1 = 99 \ Gosub L_5800
If SMER[SLMN] If EX[15] If FNR((SMER[SLMN] - SCST[SLMN]) / SMER[SLMN] * 100) < EX[15] Print #0;" *** LOW GP ***"; \ Goto L_3735
If EX[1] If FNR(SMER[SLMN] - SCST[SLMN]) < EX[1] Print #0;" *** LOW GP ***";
L_3735: If SMER[SLMN] Print #0; Using X$; Tab 105;"SUBTOTAL"; Tab 122;SMER[SLMN] \ J1 = J1 + 1
If H0[0] = 30 Print #0; Using X$; Tab 105;"INV TOTAL"; Tab 122;SMER[SLMN] \ J1 = J1 + 1
If H0[0] = 31 Print #0; Using X$; Tab 105;"C/M TOTAL"; Tab 122;SMER[SLMN] \ J1 = J1 + 1
If SORT = 2 If Not(PRTSCOST) Goto L_3790
Print #0; Using X$; Tab 105;"GROSS PROFIT"; Tab 122;SMER[SLMN] - SCST[SLMN] \ J1 = J1 + 1
If SMER[SLMN] Print #0; Using X$; Tab 105;"GROSS PROFIT %"; Tab 122;(SMER[SLMN] - SCST[SLMN]) / SMER[SLMN] * 100 \ J1 = J1 + 1
L_3790: Gosub L_5800
Print #0; Using "COMMISSION RATE: ###.##% "; Tab 86;SLSM[SLMN + 5];
Print #0; Using "AMOUNT: -----#.##"; Tab 114;SCOM[SLMN];
Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
Return 
!
L_4000: Rem "=========================================== journal totals
If Not(J8)
  If SORT = 2 Goto L_4085
  Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
  Print #0; Tab 10;"JOURNAL TOTALS";
  If Not(DETAIL) Goto L_4037
  Print #0; Tab 45;"INV COUNT"; Tab 56;"MDSE AMT"; Tab 69;"DISC";
  Print #0; Tab 75;"MISC/HAND"; Tab 86;"TAX AMT"; Tab 95;"FREIGHT";
  If S7 = 30 Print #0; Tab 107;"GP"; Tab 122;"INV TOTAL";
  If S7 = 31 Print #0; Tab 107;"GP"; Tab 122;"C/M TOTAL";
  If S7 = 39 Print #0; Tab 107;"GP"; Tab 122;"RUN TOTAL";
  Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
  L_4037: If DETAIL
    Print #0; Using "#####"; Tab 47;I_CTR;
    Print #0; Using "----###.##"; Tab 52;T9[1];
    Print #0; Using "-----#.##"; Tab 64;T9[3];
    Print #0; Using "-----#.##"; Tab 75;T9[4];
    Print #0; Using "-----#.##"; Tab 84;T9[2];
    Print #0; Using "-----#.##"; Tab 93;T9[5];
    Print #0; Using "-----#.##"; Tab 102;T11[1];
    Print #0; Using "-----###.##"; Tab 120;T9[0];
  Else 
    Print #0; Using "#######"; Tab 35;I_CTR;
    Print #0; Using "------#.##"; Tab 51;T9[2];
    Print #0; Using "-----##.##"; Tab 69;T9[4];
    Print #0; Using "--------###.##"; Tab 87;TOTCOST;
    If (T11[1] + TOTCOST) Print #0; Using "-------.-"; Tab 109;100 * T11[1] / (T11[1] + TOTCOST);
    Print #0;"" \ J1 = J1 + 1
    Print #0; Using "-------###.##"; Tab 39;T9[1];
    Print #0; Using "------#.##"; Tab 59;T9[5];
    Print #0; Using "--------###.##"; Tab 76;T9[0];
    Print #0; Using "---------#.##"; Tab 99;T11[1];
    Print #0; Using "--------#.##"; Tab 117;T10[7];
    Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
  End If 
End if
L_4085: If PASS = 0 Gosub L_6200
If P1 = 1 Gosub L_7000 \ F9 = 0 \ J1 = 90
If Not(TYPE[1]) Return 
J1 = 75;HDG = 9 \ Gosub L_5800
For J = 0 To 20 \ T9[J] = 0 \ Next J
TOTCOST = 0
If Not(J8) 
  Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
  If SORT = 2 If Not(PRTSCOST) Goto L_4115
  Print #0; Tab 28;"GROSS PROFIT"; Tab 42;"GP %";
  L_4115: If SORT = 2 Print #0; Tab 48;"COMMISSION";
  Print #0; Tab 62;"MDSE AMT"; Tab 77;"DISC"; Tab 84;"MISC/HAND";
  Print #0; Tab 96;"TAX AMT"; Tab 109;"FREIGHT";
  If S7 = 30 Print #0; Tab 122;"INV TOTAL";
  If S7 = 31 Print #0; Tab 122;"C/M TOTAL";
  If S7 = 39 Print #0; Tab 122;"RUN TOTAL";
  Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
End if
For W0 = 1 To D9[5]
  For J = 0 To 6
    If T8[W0,J] Gosub L_4165
  Next J
Next W0
W0 = 0
L_4165: Rem "==================================== grand tot's  (mtd & ytd)
If J8 Return
!
Print #0;" " \ J1 = J1 + 1 \ Gosub L_5800
If W0 Print #0;D9$;":";W0;
If Not(W0) Print #0;"ALL ";D9$;"S:";
Print #0; Tab 15;"JOURNAL TOTALS";
If SORT = 2 If Not(PRTSCOST) Goto L_4191
Print #0; Using "-----###.##"; Tab 29;COMM[W0,1];
L_4191: X3 = T8[W0,1]
If P9$[35,35] = "Y" Let X3 = X3 + T8[W0,5]
If P9$[38,38] = "Y" Let X3 = X3 + T8[W0,4]
If SORT = 2 If Not(PRTSCOST) Goto L_4200
If X3 Print #0; Using "---#.##"; Tab 40;COMM[W0,1] / X3 * 100;
L_4200: If SORT = 2 Print #0; Using "-----###.##"; Tab 47;COMM[W0,2];
Print #0; Using "--------#.##"; Tab 59;T8[W0,1];
Print #0; Using "------#.##"; Tab 72;T8[W0,3];
Print #0; Using "------#.##"; Tab 83;T8[W0,4];
Print #0; Using "------#.##"; Tab 95;T8[W0,2];
Print #0; Using "-------#.##"; Tab 106;T8[W0,5];
Print #0; Using "-------#.##"; Tab 120;T8[W0,0];
Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
If SORT = 2 If Not(PRTSCOST) Goto L_4281
L_4281: X3 = T7[1]
If P9$[35,35] = "Y" Let X3 = X3 + T7[5]
If P9$[38,38] = "Y" Let X3 = X3 + T7[4]
If SORT = 2 If Not(PRTSCOST) Goto L_4290
If X3 Print #0; Using "---#.##"; Tab 40;T7[6] / X3 * 100;
L_4290: Rem PRINT #0; USING "----------#.##"; TAB 57;T7[1]; ! "mdse amt
If SORT = 2 If Not(PRTSCOST) Goto L_4331
L_4331: X3 = T7[8]
If P9$[35,35] = "Y" Let X3 = X3 + T7[12]
If P9$[38,38] = "Y" Let X3 = X3 + T7[11]
If SORT = 2 If Not(PRTSCOST) Goto L_4340
L_4340: Rem PRINT #0; USING "----------#.##"; TAB 57;T7[8]; ! "mdse amt
J = 7 \ If W0 Return 
HDG = 0
If JSDETL Gosub L_11000
If Err 0 Gosub ERR_TRAP
Return 
!
L_4500: Rem "=========================================== detail line loop
T9[6] = 0
J2$ = " ",J2$ \ J2$ = N0 Using "##########   "
L_4515:  ! search lines
Search #5,3,1;J2$,R5,E 
If E Return 
X3 = J2$[1,10] \ If X3 <> N0 Return 
Mat Read #5,R5,8;L3;
Mat Read #5,R5,16;L4;
If SORT = 2 If MULTIS If L4[1] <> SP Goto L_4515
IF NOT(L4[0]) GOTO L_4515 ! no record #
Mat Read #5,R5,32;L5;
Mat Read #5,R5,56;L6;
Mat Read #5,R5,80;L6$;
Mat Read #5,R5,140;L1$;
Mat Read #5,R5,168;L7;
If H5[7] = 16 Or H5[7] = 8 Let L7[10] = 0
Mat Read #5,R5,250;UN;
Mat Read #5,R5,260;S3;
Mat Read #5,R5,256;OLS2; \ Mat Read #5,R5,404;OLM;
Mat Read #5,R5,446;EUN; \ Mat Read #5,R5,452;UNF;
PUNIT$ = "   ";CUNIT$ = "    ";SUNIT$ = "    ";P1$ = " ",P1$
If S7 = 39 And H0[0] = 31 ! "credit memo on BOTH run - reverse totals
  L5[0] = 0 - L5[0];L5[3] = 0 - L5[3]
  For X = 0 To 5 \ L7[X] = 0 - L7[X] \ Next X
  L7[10] = 0 - L7[10];S3[4] = 0 - S3[4]
  S3[6] = 0 - S3[6];S3[7] = 0 - S3[7];S3[9] = 0 - S3[9]
  S3[10] = 0 - S3[10];S3[12] = 0 - S3[12];S3[13] = 0 - S3[13]
  OLM[6] = 0 - OLM[6];OLM[1] = 0 - OLM[1]
  OLM[0] = 0 - OLM[0]
End If 
L5[2] = L5[2] - S3[15];L5[3] = L5[3] - OLM[1]
OLM[3] = OLM[3] - S3[15]
If Not(L3)
  Mat Read #7,L4,512;PFU1; \ Mat Read #7,L4,554;PFU2;
  Mat Read #7,L4,0;P1$; \ Mat Read #7,L4,256;A;
  Mat Read #7,L4,156;PRODB;
End If 
Gosub L_30000
COSTCHG = 0 \ If Not(L3) Gosub L_10500
For X = 0 To 3 \ SUNIT[X] = 0 \ Next X \ CUNIT = 0;PUNIT = 0
If (H5[7] = 21 Or H5[7] = 22) And J2$[7,9] = "   " Let OLS2[0] = 3
If OLS2[0] = 3 Or L3[2] >= 900 Goto L_4700
If (H5[7] = 21 Or H5[7] = 22) And J2$[7,9] = "   " Goto L_4700
For X = 1 To 3
  CNVTU[0] = 0;CNVTU[1] = UN[0];CNVTU[2] = 1;CNVTA = L7[X + 1]
  Gosub L_20000
  SUNIT[X] = AMOUNT
Next X
CNVTU[0] = 0;CNVTU[1] = UN[1];CNVTU[2] = 2;CNVTA = OLM[3]
Gosub L_20000
PUNIT = AMOUNT
CNVTU[0] = 0;CNVTU[1] = UN[2];CNVTU[2] = 2;CNVTA = L5[1]
If CPSAME Let CNVTU[1] = UN[1]
If COSTFLAG = 1 And L7[4] ! "was SORT<>2 AND COSTFLAG=1 AND L7[4]
  CNVTA = (L7[10] / L7[4])
End If 
If COSTFLAG = 3 Or COSTFLAG = 4 ! rebate/net po cost or rebate/gl cost
  Gosub GETCOST3
  CNVTA = COST3
End If 
Gosub L_20000
CUNIT = AMOUNT
CNVTU[0] = 0;CNVTU[1] = UN[1];CNVTU[2] = 2;CNVTA = L6[1]
Gosub L_20000 \ L6[1] = AMOUNT
If UN[0] > 0 Mat Read #12,UN[0],10;SUNIT$;
If UN[0] = -1 Let SUNIT$ = "CWT "
If UN[0] = -2 Let SUNIT$ = "LOT "
If UN[0] = -3 Let SUNIT$ = "LB  "
If UN[1] > 0 Mat Read #12,UN[1],10;PUNIT$;
If UN[1] = -1 Let PUNIT$ = "CWT "
If UN[1] = -2 Let PUNIT$ = "LOT "
If UN[1] = -3 Let PUNIT$ = "LB  "
If UN[2] > 0 Mat Read #12,UN[2],10;CUNIT$;
If UN[2] = -1 Let CUNIT$ = "CWT "
If UN[2] = -2 Let CUNIT$ = "LOT "
If UN[2] = -3 Let CUNIT$ = "LB  "
If CPSAME Let CUNIT$ = PUNIT$
L_4700: Gosub L_5800
If L3[2] >= 900 Let L5[3] = 0 - L5[3]
If LNDETL Gosub L_5500 Else Gosub L_6400
EXTCOST = S3[12]
If COSTFLAG = 1 Let EXTCOST = L7[10]
If COSTFLAG = 3 Or COSTFLAG = 4 ! rebate/netpo or rebate/gl
  Gosub GETCOST3
  EXTCOST = FNR(COST3 * L7[4])
End If 
T9[9] = FNR(L5[3] - EXTCOST)
T9[6] = T9[6] + T9[9]
T9[10] = T9[10] + T9[9]
Goto L_4515
!
L_4800: Rem "======================================= salesrep sub-totals
If Not(J8)
  If SORT <> 2 Return 
  Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
  If SP <> 9999 Print #0; Using "SALESPERSON ### TOTALS: "; Tab 10;SP;
  If Not(DETAIL) Goto L_4857
  Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
  If SORT = 2 If Not(PRTSCOST) Goto L_4842
  Print #0; Tab 25;"GP"; Tab 43;"CP";
  L_4842: Print #0; Tab 55;"COMMISSION";
  Print #0; Tab 68;"MDSE AMT"; Tab 81;"DISC"; Tab 87;"MISC/HAND";
  Print #0; Tab 98;"TAX AMT"; Tab 109;"FREIGHT";
  If S7 = 31 Print #0; Tab 122;"C/M TOTAL" \ J1 = J1 + 1 \ Gosub L_5800
  If S7 = 30 Print #0; Tab 122;"INV TOTAL" \ J1 = J1 + 1 \ Gosub L_5800
  If S7 = 39 Print #0; Tab 122;"RUN TOTAL" \ J1 = J1 + 1 \ Gosub L_5800
  L_4857: If DETAIL
    If SORT = 2 If Not(PRTSCOST) Goto L_4862
    Print #0; Using "-----###.##"; Tab 17;T10[6];
    Print #0; Using "-----###.##"; Tab 35;TOTNET;
  L_4862: Print #0; Using "-----###.##"; Tab 54;T10[7];
    Print #0; Using "-----###.##"; Tab 65;T10[1];
    Print #0; Using "-----#.##"; Tab 76;T10[3];
    Print #0; Using "-----#.##"; Tab 87;T10[4];
    Print #0; Using "-----#.##"; Tab 95;T10[2];
    Print #0; Using "----#.##"; Tab 108;T10[5];
    Print #0; Using "-----###.##"; Tab 120;T10[0];
    Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
  End If 
  If Not(DETAIL)
    Print #0; Using "-----###.##"; Tab 44;T10[1];
    Print #0; Using "----#.##"; Tab 56;T10[2];
    Print #0; Using "---#.##"; Tab 66;T10[5];
    Print #0; Using "---##.##"; Tab 74;T10[4];
    Print #0; Using "----###.##"; Tab 83;T10[0];
    If SORT = 2 If Not(PRTSCOST) Goto L_4894
    Print #0; Using "-----###.##"; Tab 93;TOTCOST;
    Print #0; Using "-----#.##"; Tab 106;T11[1];
    If T11[1] + TOTCOST Print #0; Using "----.-"; Tab 115;100 * T11[1] / (T11[1] + TOTCOST);
  L_4894: Print #0; Using "-----#.##"; Tab 122;T10[7];
    Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
  End If 
  If SP = 9999 Goto L_4965
  Goto L_4965
  If DETAIL Print #0; Using "-----###.##"; Tab 17;SLSMTDGP + T10[6]; Tab 54;SLSMS1[2] + T10[7]; Tab 65;SLSMTDSL + (T10[1] - T10[3]);
  If Not(DETAIL) Print #0; Using "----###.##"; Tab 45;SLSMTDSL + (T10[1] - T10[3]); Tab 94;(SLSMTDSL - SLSMTDGP) + TOTCOST;
  If Not(DETAIL) Print #0; Using "----###.##"; Tab 105;SLSMTDGP + T11[1];
  If Not(DETAIL) Print #0; Using "----.-"; Tab 115;100 * (SLSMTDGP + T11[1]) / ((SLSMTDSL - SLSMDGP) + TOTCOST + SLSMTDGP + T11[1])
  If Not(DETAIL) Print #0; Using "----###.##"; Tab 121;SLSMS1[2] + T10[7];
  L_4965: 
End if
!
For J = 0 To 7 \ T10[J] = 0 \ Next J
TOTCOST = 0;T11[1] = 0;TOTNET = 0;TOTFCST = 0
J1 = 100
If Not(J8) Print #0;" "
Return 
!
L_5000: Rem "======================================= invoice header line
I_CTR = I_CTR + 1
If J8 
  if comd call addtostr(e$,rstr$,tmp1$+rdel$)
  tmp1$ = OREF[1] Using "########",fdel$
  tmp1$ = tmp1$, H0[7] Using "######",fdel$
  tmp1$ = tmp1$, H5[7] Using "##",fdel$,D1$,fdel$
  tmp1$ = tmp1$, H0[4] Using "######",fdel$
  tmp1$ = tmp1$, rtrim$(C1$[1,11]),fdel$,rtrim$(P0$),fdel$
  tmp1$ = tmp1$, rtrim$(S1$[1,20]),fdel$
  tmp1$ = tmp1$, H5[0] Using "###",fdel$
  tmp1$ = tmp1$, H0[11] Using "###",fdel$,rtrim$(S2$[1,20]),fdel$
  tmp1$ = tmp1$, CFIN[8] Using "###.##%",fdel$
  comd = 1 \ Return
End if
!
Print #0; Using "########"; Tab 1;OREF[1];
Print #0; Using "######"; Tab 10;H0[7];
! Print #0; Using "##"; Tab 17;H5[7]; Tab 21;D1$;
PRINT #0; USING "##"; TAB 17;H5[7]; 
If H5[7]=19  ! "bill completes
  If Ot19Part Print #0;Tab 18;"P"; Else Print #0;Tab 18;"M";
Endif
Print #0; TAB 21;D1$; ! "type / invoice date
Print #0; Using "######"; Tab 30;H0[4];
Print #0; Tab 37;C1$[1,11]; Tab 49;P0$;
Print #0; Tab 69;S1$[1,20];
Print #0; Using "###"; Tab 90;H5[0];
Print #0; Using "### "; Tab 94;H0[11];S2$[1,20];
Print #0; Using "###.##%"; Tab 123;CFIN[8];
Print #0;""
Print #0;"" \ J1 = J1 + 2 \ Gosub L_5800
If Not(LNDETL) Goto L_5140
Print #0; Tab 1;"LIN"; Tab 5;"ITEM CODE"; Tab 18;"DESCRIPTION";
Print #0; Tab 39;"ORDERED"; Tab 52;"B'ORD"; Tab 61;"SHIPPED";
Print #0; Tab 69;"U/M"; Tab 78;"PRICE";
If SORT = 2 If Not(PRTSCOST) Goto L_5125
If COSTFLAG = 1 Print #0; Tab 91;"G/L";
If COSTFLAG = 2 Print #0; Tab 90;"LOAD";
If COSTFLAG = 3 Print #0; Tab 89;"RB/NET";
If COSTFLAG = 4 Print #0; Tab 89;" RB/GL";
Print #0; Tab 95;"COST"; Tab 106;"C"; Tab 111;"EXT COST";
L_5125: Print #0; Tab 122;"EXT PRICE"
J1 = J1 + 1 \ Gosub L_5800
Goto L_5190
L_5140: Rem 1 LINE SUMMARY
Print #0; Tab 1;"LIN"; Tab 5;"ITEM CODE"; Tab 18;"DESCRIPTION";
Print #0; Tab 51;"SHIPPED";
Print #0; Tab 62;"EXT PRICE";
If SORT = 2 If Not(PRTSCOST) Goto L_5175
Print #0; Tab 74;"EXT COST"; Tab 86;"G PROFIT";
Print #0; Tab 97;"PCT"; Tab 104;"C PROFIT";
L_5175: Print #0; Tab 115;"COM%"; Tab 124;"COMM $"
J1 = J1 + 1 \ Gosub L_5800
L_5190: Return 
!
L_5200: Rem "=========================================== invoice totals
If J8 Return
!
Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
If SORT = 2 If MULTIS Gosub L_3700 \ Goto L_5290
If J1 + 3 >= J9 Let J1 = 99 \ Gosub L_5800
If H0[0] = 30 Print #0; Using "INVOICE ######## TOTALS: "; Tab 5;"*** ";OREF[1];
If H0[0] = 31 Print #0; Using "CREDIT  ######## TOTALS: "; Tab 5;"*** ";H0[7];
If H5[7]=19 And OT19Part ! "
   Print #0; TAB 25;" * * P A R T I A L  S H I P  O F  OT 19 * *";
   Goto NoInvTtls:
Endif
X$ = "-----#.##";X1$ = "------#.##"
If P1 = 1 If T2[10] Gosub L_5300
If H5[13] If EX[15] If FNR((H5[13] - EXTOTCOST) / H5[13] * 100) < EX[15] Print #0;" *** LOW GP ***"; \ Goto LBL
If EX[1] If FNR(H5[13] - EXTOTCOST) < EX[1] Print #0;" *** LOW GP ***";
LBL: Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
If MULTIS Gosub L_6000
If SORT = 2 If Not(PRTSCOST) Goto L_5214
If COSTFLAG <> 2
  If COSTFLAG = 1 Print #0; Tab 7;"  G/L COST";
  If COSTFLAG = 4 Print #0; Tab 7;"RB/GL COST";
  If COSTFLAG = 3 Print #0; Tab 7;"RB/PO COST";
End If 
Print #0; Tab 25;"GP"; Tab 32;"PCT"; Tab 43;"CP";
L_5214: If Not(MULTIS) Print #0; Tab 49;"RATE"; Tab 55;"COMMISSION";
Print #0; Tab 68;"MDSE AMT"; Tab 81;"DISC"; Tab 87;"MISC/HAND";
Print #0; Tab 97;"TAX AMT"; Tab 105;"FREIGHT"; Tab 113;"FRT COST";
If H0[0] = 30 Print #0; Tab 122;"INV TOTAL" \ J1 = J1 + 1 \ Gosub L_5800
If H0[0] = 31 Print #0; Tab 122;"C/M TOTAL" \ J1 = J1 + 1 \ Gosub L_5800
If SORT = 2 If Not(PRTSCOST) Goto L_5245
If COSTFLAG <> 2
  Print #0; Using X1$; Tab 7;(EXTOTCOST);
End If 
Print #0; Using X$; Tab 19;(H5[13] - EXTOTCOST);
T0 = 0 \ If H5[13] Let T0 = FNR((H5[13] - EXTOTCOST) / H5[13] * 100)
Print #0; Using "---#.##"; Tab 28;T0;
Print #0; Using X$; Tab 37;INVNET;
L_5245: If MULTIS Goto L_5260
Print #0; Using "###.##"; Tab 47;SLSM[5];
Print #0; Using X$; Tab 56;SCOM[0];
L_5260: Print #0; Using X1$; Tab 66;T2[1];
Print #0; Using X$; Tab 76;T2[3];
Print #0; Using X$; Tab 87;T2[4];
Print #0; Using X$[2]; Tab 96;T2[7];
Print #0; Using X$[2]; Tab 104;T2[5];
Print #0; Using X$[2]; Tab 113;T2[20];
Print #0; Using X1$; Tab 121;T2[0]
NoInvTtls: ! "
Print #0;"" \ J1 = J1 + 2 \ Gosub L_5800
L_5290: Return 
!
L_5300: Rem "================================================= cash
Print #0; Using "PAID:-------#.##";T2[12]; Tab 53;
If CSH0[2] = 0 Print #0;"     PAID BY: NO PAY";
If CSH0[2] = 1 Print #0;"     PAID BY: CASH";
If CSH0[2] = 2 Print #0;"     PAID BY: CHECK #";CSH0$[37,56];
If CSH0[2] = 3
	D$="CRDT CARD"
	Let Z1 = CCTYP1 !;D$ = CCTYPE$[Z1 * 10 - 9,Z1 * 10]
	IF Z1>0 AND Z1<11 LET D$ = CCTYPE$[Z1 * 10 - 9,Z1 * 10]
ENDIF
If CSH0[2] = 3 Print #0;"     PAID BY: ";D$;
If CSH0[2] = 4 Print #0;"     PAID BY: ";CSH0$[1,18];
Print #0; Using "-------#.##"; Tab 88;CSH1[0]
J1 = J1 + 1
If CSH0[3] Print #0;""; Tab 53;
If CSH0[3] = 1 Print #0;"     PAID BY: CASH";
If CSH0[3] = 2 Print #0;"     PAID BY: CHECK #";CSH0$[57,76];
If CSH0[3] = 3 
	D$="CRDT CARD"
	Let Z1 = CCTYP2
	IF Z1>0 AND Z1<11 LET D$ = CCTYPE$[Z1 * 10 - 9,Z1 * 10]
ENDIF ! ;D$ = CCTYPE$[Z1 * 10 - 9,Z1 * 10]
If CSH0[3] = 3 Print #0;"     PAID BY: ";D$;
If CSH0[3] = 4 Print #0;"     PAID BY: ";CSH0$[19,39];
If CSH0[3] Print #0; Using "-------#.##"; Tab 88;CSH1[1] / J1 = J1 + 1
Return 
!
L_5500: Rem "============================================= invoice detail line
If J8
  If (H5[7] = 21 Or H5[7] = 22) And J2$[7,9] = "   " 
    tmp$ = tmp1$, J2$[10,10],fdel$
  Else
    tmp$ = tmp1$, L3[2] Using "###",fdel$
  End if
  tmp$ = tmp$, rtrim$(L1$[1,12])," ",L1$[14,16],fdel$
  tmp$ = tmp$, rtrim$(L6$[1,16])
  If OLS2[0] <> 3 
    tmp$ = tmp$, " ",fdel$,rtrim$(L6$[31,50]),fdel$
    tmp$ = tmp$, SUNIT[1] Using "--------.##",fdel$,SUNIT[2] Using "--------.##",fdel$
    tmp$ = tmp$, SUNIT[3] Using "--------.##",fdel$
    tmp$ = tmp$, SUNIT$,fdel$
    tmp$ = tmp$, PUNIT Using PMASK$,fdel$,PUNIT$,fdel$
    If SORT <> 2 Or PRTSCOST
      tmp$ = tmp$, CUNIT Using PMASK$,fdel$,CUNIT$,fdel$
      If COSTFLAG = 1
        If COSTCHG Let tmp$ = tmp$, "*",fdel$ Else Let tmp$ = tmp$,"",fdel$
      End If 
      If COSTFLAG = 3 Or COSTFLAG = 4
        If REBFLAG Let tmp$ = tmp$, "*",fdel$ Else Let tmp$ = tmp$,"",fdel$
      End If
      EXTCOST = S3[12]
      If COSTFLAG = 1 Let EXTCOST = L7[10]
      If COSTFLAG = 3 Or COSTFLAG = 4 ! rebate/net po or rebate/gl
        Gosub GETCOST3
        EXTCOST = FNR(COST3 * L7[4])
      End If 
      tmp$ = tmp$, EXTCOST Using "-------#.##",fdel$
    End if
    tmp$ = tmp$, L5[3] Using "-------#.##",fdel$
	If SORT <> 2 Or PRTSCOST
      tmp$ = tmp$, L5[3] - EXTCOST Using "-----#.##",fdel$ !!G PROFIT	  
      T0 = 0 \ If L5[3] Let T0 = FNR((L5[3] - EXTCOST) / L5[3] * 100)
      tmp$ = tmp$, T0 Using "---#.##%",fdel$ !!(---#.##%)
      LDCOST = L5[3] - EXTCOST \ LDCOST = FNR(LDCOST - (L5[3] * CFIN[8] / 100))
      tmp$ = tmp$, LDCOST Using "-----#.##",fdel$ !!C PROFIT 
    End if
    tmp$ = tmp$, OLM[5] Using "###.##",fdel$ !!COM%
    tmp$ = tmp$, OLM[6] Using "-------#.##",fdel$ !!COMM$
    If S3[0] Let tmp$ = tmp$, S3[0] Using "####.#####",fdel$ !!CUTTING CHARGE 
    If SORT <> 2 Or PRTSCOST 
       If S3[1] Let tmp$ = tmp$, S3[1] Using "####.#####",fdel$ !!CUTTING COST 
    End if
  Else
    tmp$ = tmp$, " ",rtrim$(L6$[21,30]),fdel$,rtrim$(L6$[31,50])
	tmp$ = tmp$, rtrim$(L6$[51,60]),fdel$
	tmp$ = tmp$, "",fdel$,"",fdel$,"",fdel$
	tmp$ = tmp$, "",fdel$,"",fdel$,"",fdel$
    If SORT <> 2 Or PRTSCOST
      tmp$ = tmp$, "",fdel$,"",fdel$,"",fdel$,"",fdel$
      tmp$ = tmp$, "",fdel$,"",fdel$,"",fdel$,"",fdel$
	End if
	tmp$ = tmp$, "",fdel$,"",fdel$,"",fdel$
	If S3[0] Let tmp$ = tmp$,"",fdel$
  End if
  comd = 0 \ call addtostr(e$,rstr$,tmp$+rdel$)
  Return
End if
!
If (H5[7] = 21 Or H5[7] = 22) And J2$[7,9] = "   " Print #0; Tab 2;J2$[10,10]; \ Goto L_5520
Print #0; Using "###"; Tab 1;L3[2];
L_5520: Print #0; Tab 5;L1$[1,12]; Tab 18;L6$[1,16];
If OLS2[0] = 3 Print #0;L6$[21,30];
If OLS2[0] = 3 Goto L_5600
Print #0; Using "--------.##"; Tab 35;SUNIT[1];SUNIT[2];SUNIT[3];
Print #0; Tab 69;SUNIT$; 
Print #0; Using PMASK$; Tab 74;PUNIT;"/";PUNIT$; !!price u/m
If SORT = 2 If Not(PRTSCOST) Goto L_5590
Print #0; Using PMASK$; Tab 91;CUNIT;"/";CUNIT$;
If COSTFLAG = 1
  If COSTCHG Print #0; Tab 106;"*";
End If 
If COSTFLAG = 3 Or COSTFLAG = 4
  If REBFLAG Print #0; Tab 106;"*";
End If 
EXTCOST = S3[12]
If COSTFLAG = 1 Let EXTCOST = L7[10]
If COSTFLAG = 3 Or COSTFLAG = 4 ! rebate/net po or rebate/gl
  Gosub GETCOST3
  EXTCOST = FNR(COST3 * L7[4])
End If 
Print #0; Using "-------#.##"; Tab 108;EXTCOST;
L_5590: Print #0; Using "-------#.##"; Tab 120;L5[3];
L_5600: If Not(J8) Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
Print #0; Tab 5;L1$[14,16]; Tab 18;L6$[31,50];
If OLS2[0] = 3 Print #0;L6$[51,60];
If OLS2[0] = 3 Goto L_5690
If SORT = 2 If Not(PRTSCOST) Goto L_5652
Print #0; Using "G PROFIT -----#.##  "; Tab 50;L5[3] - EXTCOST;
T0 = 0 \ If L5[3] Let T0 = FNR((L5[3] - EXTCOST) / L5[3] * 100)
Print #0; Using "(---#.##%)";T0;
LDCOST = L5[3] - EXTCOST \ LDCOST = FNR(LDCOST - (L5[3] * CFIN[8] / 100))
Print #0; Using "C PROFIT -----#.##"; Tab 81;LDCOST;
L_5652: Print #0; Using "###.##"; Tab 100;"COM% ";OLM[5];
Print #0; Using "-------#.##"; Tab 112;"COMM$ ";OLM[6];
Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
If S3[0] Print #0; Using "CUTTING CHARGE ####.#####"; Tab 50;S3[0];
If SORT = 2 If Not(PRTSCOST) Goto L_5690
If S3[1] Print #0; Using "CUTTING COST ####.#####"; Tab 80;S3[1];
L_5690: Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
Return
!
L_5700: Rem PRINT SUMMARY LINE !!detail - "S"
If J8
  I_CTR = I_CTR + 1
  tmp$ = tmp1$, OREF[1] Using "########",fdel$
  tmp$ = tmp$, H0[4] Using "######",fdel$,rtrim$(C1$[1,19]),fdel$,H0[7],fdel$
  If SORT = 2 If MULTIS Gosub L_3600 \ Goto L_5712
  tmp$ = tmp$, T2[1] Using "------#.##",fdel$
  tmp$ = tmp$, T2[7] Using "----#.##",fdel$,T2[5] Using "----#.##",fdel$,T2[4] Using "----#.##",fdel$
  tmp$ = tmp$, T2[0] Using "------#.##",fdel$
  If SORT <> 2 Or PRTSCOST
    tmp$ = tmp$, EXTOTCOST Using "------#.##",fdel$
    tmp$ = tmp$, H5[13] - EXTOTCOST Using "------#.##",fdel$
    If H5[13] 
	  tmp$ = tmp$, (H5[13] - EXTOTCOST) / H5[13] * 100 Using "----.-",fdel$
	Else
	  tmp$ = tmp$,"",fdel$
	End if
  End if
 IF MULTIS OR TOTCOM<>SCOM[0] !MULT SALESMAN
   tmp$ = tmp$, TOTCOM Using "------#.##",fdel$
 ELSE 
   tmp$ = tmp$, SCOM[0] Using "------#.##",fdel$
 ENDIF 
L_5712: tmp$ = tmp$, H5[7] Using "##",fdel$
  comd = 0 \ call addtostr(e$,rstr$,tmp$+rdel$)
  Return
End if
!
I_CTR = I_CTR + 1
Print #0; Using "########";OREF[1];
Print #0; Using "######"; Tab 9;H0[4]; Tab 16;C1$[1,19]; Tab 36;H0[7];
If H5[7]=19 And OT19Part ! "part ship - no totals
  Print #0; TAB 50;" * * P A R T I A L  S H I P  O F  OT 19 * *";
  Goto L_5765:
Endif
If SORT = 2 If MULTIS Gosub L_3600 \ Goto L_5765
Print #0; Using "------#.##"; Tab 42;T2[1];
Print #0; Using "----#.## "; Tab 53;T2[7];T2[5];T2[4];
Print #0; Using "------#.## "; Tab 80;T2[0];
If SORT = 2 If Not(PRTSCOST) Goto L_5760
Print #0; Using "------#.## ";EXTOTCOST;
Print #0; Using "------#.## ";H5[13] - EXTOTCOST;
If H5[13] Print #0; Using "----.-"; Tab 112;(H5[13] - EXTOTCOST) / H5[13] * 100;
 L_5760: IF MULTIS OR TOTCOM<>SCOM[0] !MULT SALESMAN
   Print #0; Using "------#.##"; Tab 119;TOTCOM;
   IF TOTCOM<>SCOM[0] PRINT #0;"*"; !TO NOTE THE TOTAL IS MORE THAN 1 ITEM
 ELSE 
   Print #0; Using "------#.##"; Tab 119;SCOM[0];
 ENDIF 
L_5765: Print #0; Using "##"; Tab 130;H5[7]
J1 = J1 + 1
Return
!
L_5800: Rem "=========================================== headings
If J8 Return
!
If J1 < J9 Return 
!!If J2 If J8 Input @0,23;"PRESS <CR> TO CONTINUE "J$ \ Print 'CS';
If J2 Print #0;"\14\";
J2 = J2 + 1 \ J1 = 8
Print #0;"\12\";
Print #0; Tab 10;ARDATE$; Tab (64 - Len(CNAME$) / 2);CNAME$; Tab 120;"PAGE";J2
Print #0;" MU937A - ";Msc$(3);
If S7 = 30 Print #0; Tab 40;"M O N T H L Y   I N V O I C E   J O U R N A L";
If S7 = 31 Print #0; Tab 40;"M O N T H L Y   C R E D I T   J O U R N A L ";
If S7 = 39 Print #0; Tab 40;"M O N T H L Y   I N V & C / M   J O U R N A L";
If W1 Print #0; Tab 100;D9$;":";W1;
If Not(W1) Print #0; Tab 100;"ALL ";D9$;"S";
Print #0; Tab 120;AR_MTH$[1,2];"/";AR_MTH$[3,4]
iF HDATER ! DATE RANGE
	X2=SHDATE[0] \ GOSUB JULTODATE:
	PRINT #0;TAB 5;"DATES: ";X$;" TO ";
	X2=SHDATE[1] \ GOSUB JULTODATE
	PRINT #0;X$;
ELSE
	Print #0; Tab 5;N1$; ! "reprint of journal
Endif
If P1 = 1 Print #0; Tab 52;"C A S H   C U S T O M E R S";
If P1 = 2 Print #0; Tab 50;"C R E D I T   C U S T O M E R S";
If DIV Print #0; Tab 100;"DIVISION:";DIV Else Print #0; Tab 100;"ALL DIVISIONS"
If HDG Goto L_5885
If DETAIL If Not(F9) Goto L_5900
If Not(DETAIL) If Not(F9) Goto L_5950
If F9 = 99 Goto L_6250
Print #0;""
Print #0; Tab 1;"ENTD BY"; Tab 11;"CASH TND/CHNG"; Tab 26;"INV$/SHORT";
Print #0; Tab 41;"CHKS TND/CHNG"; Tab 56;"INV$/SHORT";
Print #0; Tab 74;"CRED CARD"; Tab 85;"INV$/SHORT"; Tab 114;"DRAWER TOTAL"
L_5885: Print #0;""
Return 
!
L_5900: Rem "master heading
If J8 Return
!
Print #0;""
Print #0; Tab 1;"INV #"; Tab 8;"ORD #"; Tab 15;"ORD";
Print #0; Tab 23;"DATE"; Tab 30;"CUST CODE / NAME";
Print #0; Tab 49;"PO NUMBER"; Tab 69;"SHIPPED TO"; Tab 90;"TKN";
Print #0; Tab 95;"SLSM CODE / NAME"; Tab 125;"COMMN"
Print #0; Tab 15;"TYPE"; Tab 90;"BY"; Tab 126;"S/C"
Print #0;""
Return
!
L_5950: Rem SUMMARY HEADING
If J8 Return
!
Print #0;""
if toto=0
Print #0; Tab 2;"INV"; Tab 10;"C U S T O M E R"; Tab 37;"  ORD"; 
Endif
Print #0; Tab 47;"AMOUNT";
Print #0; Tab 59;"TAX"; Tab 64;"FREIGHT"; Tab 75;"MISC"; Tab 84;" TOTAL";
If SORT = 2 If Not(PRTSCOST) Goto L_5967
Print #0; Tab 96;"TOTAL"; Tab 105;"GROSS"; Tab 113;"PROFIT";
L_5967: Print #0; Tab 124;"COMM"; Tab 130;"OT"
Print #0; Tab 3;"#"; Tab 10;"CODE"; Tab 18;"NAME"; Tab 40;"#"; Tab 84;"AMOUNT";
If SORT = 2 If Not(PRTSCOST) Goto L_5980
If COSTFLAG = 1 Print #0; Tab 94;"G/L";
If COSTFLAG = 2 Print #0; Tab 93;"LOAD";
If COSTFLAG = 3 Print #0; Tab 92;"RB/NET";
If COSTFLAG = 4 Print #0; Tab 92;" RB/GL";
Print #0; Tab 97;"COST"; Tab 105;"PROFIT"; Tab 116;"%"; Tab 125;"AMT" \ Goto L_5990
L_5980: Print #0; Tab 125;"AMT"
L_5990: Return 
!
L_6000: Rem "============================== salesman commissions
If Not(SLSM[0] + SLSM[1] + SLSM[2] + SLSM[3] + SLSM[4]) Goto L_6110
If H5[7]=19 And OT19Part Goto L_6110: ! "no commission
Print #0; Tab 64;" MERCH $  SLSM COST" \ J1 = J1 + 1
For X5 = 0 To 4
  If Not(SLSM[X5]) Goto L_6100
  K11$ = " ",K11$ \ K11$ = SLSM[X5] Using "###"
  Search #11,2,1;K11$,V1,E !\ If E > 1 Gosub ERR_SEARCH
  If E = 1 Let S$ = " ",S$ \ S$ = "SALESMAN NOT ON FILE"
  If Not(E) Mat Read #11,V1,0;S$;
  Print #0; Using "SLSM ### "; Tab 30;SLSM[X5];S$[1,25];
  Print #0; Using "-----#.## "; Tab 64;SMER[X5];
  If SORT = 2 If Not(PRTSCOST) Goto L_6080
  Print #0; Using "-----#.## "; Tab 74;SCST[X5];
L_6080: Print #0; Using " COMMIS  ###.##%"; Tab 84;SLSM[X5 + 5];
  Print #0; Using " COMMIS -----#.##";SCOM[X5]
  J1 = J1 + 1 \ Gosub L_5800
L_6100: Next X5
L_6110: Return 
L_6200: Rem ENT'D BY TOTALS
If Not(ENTD) Return 
If Not(TYPE[1]) Return 
J1 = 90 \ F9 = 99 \ Gosub L_5800
Mat GT = Zer
For J = 0 To 999
  REC = J \ Gosub L_6700
  If Not(T16[7]) Goto L_6235
  Gosub L_6500
  Gosub L_6300
L_6235: Next J
Gosub L_6520
F9 = 0
Return 
!
L_6250: Rem HEADING
If J8 Return
!
Print #0;""
Print #0; Tab 5;"ENTERED BY TOTALS";
Print #0; Tab 24;"INV COUNT"; Tab 39;"MDSE AMT"; Tab 53;"DISC";
Print #0; Tab 59;"MISC/HAND"; Tab 74;"TAX AMT"; Tab 87;"FREIGHT";
If S7 = 30 Print #0; Tab 99;"INV TOTAL";
If S7 = 31 Print #0; Tab 99;"C/M TOTAL";
If S7 = 39 Print #0; Tab 99;"RUN TOTAL";
Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
Return 
!
L_6300: Rem PRINT LINE
If J8
  tmp$ = tmp1$, J Using "###",fdel$
  tmp$ = tmp$, T16[7] Using "#########",fdel$
  tmp$ = tmp$, T16[1] Using "--------#.##",fdel$
  tmp$ = tmp$, T16[3] Using "-----#.##",fdel$
  tmp$ = tmp$, T16[4] Using "-----#.##",fdel$
  tmp$ = tmp$, T16[2] Using "-------#.##",fdel$
  tmp$ = tmp$, T16[5] Using "-------#.##",fdel$
  tmp$ = tmp$, T16[0] Using "--------#.##",fdel$
  comd = 0 \ call addtostr(e$,rstr$,tmp$+rdel$)
  Return
End if
!
Print #0; Using "###"; Tab 5;J;
Print #0; Using "#########"; Tab 24;T16[7];
Print #0; Using "--------#.##"; Tab 35;T16[1];
Print #0; Using "-----#.##"; Tab 48;T16[3];
Print #0; Using "-----#.##"; Tab 59;T16[4];
Print #0; Using "-------#.##"; Tab 70;T16[2];
Print #0; Using "-------#.##"; Tab 83;T16[5];
Print #0; Using "--------#.##"; Tab 96;T16[0];
Print #0;""
J1 = J1 + 1 \ Gosub L_5800
Return 
!
L_6400: Rem ORDER LINE SUMMARY (1 LINER)
If J8
  If (H5[7] = 21 Or H5[7] = 22) And J2$[7,9] = "   " 
    tmp$ = tmp1$, J2$[10,10],fdel$
  Else
    tmp$ = tmp1$, L3[2] Using "###",fdel$
  End if
  tmp$ = tmp$, rtrim$(L1$[1,12]),fdel$,rtrim$(L6$[1,25]),fdel$
  If OLS2[0] <> 3 
    tmp$ = tmp$, SUNIT[3] Using "--------.##",fdel$
    tmp$ = tmp$, L5[3] Using "-------#.##",fdel$
    If SORT <> 2 Or PRTSCOST
      EXTCOST = S3[12]
      If COSTFLAG = 1 Let EXTCOST = L7[10]
      If COSTFLAG = 3 Or COSTFLAG = 4 !! rebate/net po or rebate/gl
        Gosub GETCOST3
        EXTCOST = FNR(COST3 * L7[4])
      End If 
      tmp$ = tmp$, EXTCOST Using "-------#.##"
      If COSTCHG Let tmp$ = tmp$, "*",fdel$ Else Let tmp$ = tmp$,"",fdel$
      tmp$ = tmp$, FNR(L5[3] - EXTCOST) Using "-------#.##",fdel$
      T0 = 0 \ If L5[3] Let T0 = FNR((L5[3] - EXTCOST) / L5[3] * 100)
      tmp$ = tmp$, T0 Using "---#.##",fdel$
      LDCOST = L5[3] - EXTCOST \ LDCOST = FNR(LDCOST - (L5[3] * CFIN[8] / 100))
      tmp$ = tmp$, LDCOST Using "-------#.##",fdel$
    Else
      tmp$ = tmp$,"",fdel$,"",fdel$,"",fdel$
      tmp$ = tmp$,"",fdel$,"",fdel$
	End if
    If OLM[5] tmp$ = tmp$, OLM[5] Using "###.##",fdel$ Else Let tmp$ = tmp$,"",fdel$
    If OLM[6] tmp$ = tmp$, OLM[6] Using "-------#.##",fdel$ Else Let tmp$ = tmp$,"",fdel$
  Else
    tmp$ = tmp$,"",fdel$,"",fdel$
	If SORT <> 2 Or PRTSCOST
	  tmp$ = tmp$,"",fdel$,"",fdel$,"",fdel$
      tmp$ = tmp$,"",fdel$,"",fdel$
	End if
    tmp$ = tmp$,"",fdel$,"",fdel$
  End if
  comd = 0 \ call addtostr(e$,rstr$,tmp$+rdel$)
  Return 
End if
If (H5[7] = 21 Or H5[7] = 22) And J2$[7,9] = "   " Print #0; Tab 2;J2$[10,10]; \ Goto L_6420
Print #0; Using "###"; Tab 1;L3[2];
L_6420: Print #0; Tab 5;L1$[1,12]; Tab 18;L6$[1,25];
If OLS2[0] = 3 Goto L_6485
Print #0; Using "--------.##"; Tab 47;SUNIT[3];
Print #0; Using "-------#.##"; Tab 60;L5[3];
If SORT = 2 If Not(PRTSCOST) Goto L_6475
EXTCOST = S3[12]
If COSTFLAG = 1 Let EXTCOST = L7[10]
If COSTFLAG = 3 Or COSTFLAG = 4 ! rebate/net po or rebate/gl
  Gosub GETCOST3
  EXTCOST = FNR(COST3 * L7[4])
End If 
Print #0; Using "-------#.##"; Tab 71;EXTCOST;
If COSTCHG Print #0; Tab 82;"*";
Print #0; Using "-------#.##"; Tab 83;FNR(L5[3] - EXTCOST);
T0 = 0 \ If L5[3] Let T0 = FNR((L5[3] - EXTCOST) / L5[3] * 100)
Print #0; Using "---#.##"; Tab 94;T0;
LDCOST = L5[3] - EXTCOST \ LDCOST = FNR(LDCOST - (L5[3] * CFIN[8] / 100))
Print #0; Using "-------#.##"; Tab 101;LDCOST;
L_6475: If OLM[5] Print #0; Using "###.##"; Tab 113;OLM[5];
If OLM[6] Print #0; Using "-------#.##"; Tab 119;OLM[6];
L_6485: Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
Return 
!
L_6500: Rem calc grand totals
GT[1] = GT[1] + T16[7];GT[2] = GT[2] + T16[1];GT[3] = GT[3] + T16[3]
GT[4] = GT[4] + T16[4];GT[5] = GT[5] + T16[2];GT[6] = GT[6] + T16[5]
GT[7] = GT[7] + T16[0]
Return 
!
L_6520: Rem print grand totals
If J8 Return
!
Print #0; Tab 24;"---------"; Tab 35;"------------"; Tab 49;"--------";
Print #0; Tab 59;"---------"; Tab 70;"-----------"; Tab 83;"-----------";
Print #0; Tab 96;"------------"
J1 = J1 + 1 \ Gosub L_5800
Print #0; Using "#########"; Tab 24;GT[1];
Print #0; Using "---------#.##"; Tab 34;GT[2];
Print #0; Using "------#.##"; Tab 47;GT[3]; Tab 58;GT[4];
Print #0; Using "--------#.##"; Tab 69;GT[5]; Tab 82;GT[6];
Print #0; Using "---------#.##"; Tab 95;GT[7]
J1 = J1 + 1 \ Gosub L_5800
Return 
!
L_6600: Rem "================================================ cash sale logic
For X2 = 0 To 4 \ CSH0[X2] = 0 \ Next X2
For X2 = 0 To 2 \ CSH1[X2] = 0 \ Next X2
K6$ = " ",K6$
K6$ = N0 Using "##########"
Search #10,2,1;K6$,R6,E
If E Return 
Mat Read #10,R6,0;CSH0
Mat Read #10,R6,20;CSH1
Mat Read #10,R6,38;CSH0$;
CCTYP1 = Fra(CSH0[2]) * 10 !Using "#"
CSH0[2] = Int(CSH0[2])
CCTYP2 = Fra(CSH0[3]) * 10 !Using "#"
CSH0[3] = Int(CSH0[3])
Return 
!
L_6700: Rem READ TEMP
Mat Read #16,REC,0;T4;
Mat Read #16,REC,30;T5;
Mat Read #16,REC,60;T6;
Mat Read #16,REC,90;T16;
Return 
!
L_6750: Rem WRITE TEMP
Mat Write #16,REC,0;T4;
Mat Write #16,REC,30;T5;
Mat Write #16,REC,60;T6;
Mat Write #16,REC,90;T16;
Return 
!
L_6800: Rem BUILD TEMPORARY WORKFILE
TFLE$ = " ",TFLE$
TFLE$ = "[1000:72]6/REGTEMP",rtrim$(UserID$),"!"
Build #16,TFLE$
Close #16
TFLE$ = "6/REGTEMP",rtrim$(UserID$) ! TFLE$[10]
Eopen #16,TFLE$
Return 
!
L_7000: Rem "================================================= cash totals
F9 = 9 \ J1 = 90
Gosub L_5800
For I = 1 To 999
  REC = I \ Gosub L_6700
  If T6[4] Gosub L_7030
Next I
Goto L_7200
!
L_7030: Rem PRINT IT
If Not(J8)
  Print #0; Using "###"; Tab 1;I;
  Print #0; Using "-----,--#.##"; Tab 11;T6[0];T5[0]; Tab 41;T6[1];
  Print #0; Using "-----,--#.##";T5[1]; Tab 71;T6[2];T5[2];
  T6[3] = FNR(T6[0] + T6[1] + T6[2]) \ T5[3] = FNR(T5[0] + T5[1] + T5[2])
  Print #0; Using "---,---,--#.##"; Tab 101;T6[3];T6[4]
  Gosub L_7300
  Print #0; Using "-----,--#.##"; Tab 11;T9[11];T4[0]; Tab 41;T9[12];
  Print #0; Using "-----,--#.##";T4[1]; Tab 71;T9[13];T4[2];
  T4[3] = FNR(T4[0] + T4[1] + T4[2]) \ Gosub L_7300
  Print #0; Using "---,---,--#.##"; Tab 101;T9[14];T4[3];
  Print #0;"\15\" \ J1 = J1 + 2 \ Gosub L_5800
End if
For X = 0 To 4 \ TTOT[X + 10] = TTOT[X + 10] + T6[X]
  TTOT[X + 5] = TTOT[X + 5] + T5[X] \ TTOT[X] = TTOT[X] + T4[X]
  T6[X] = 0
Next X
REC = I \ Gosub L_6750
Return 
!
L_7200: Rem TOTALS
If J8 Return
!
If Not(TTOT[8]) Goto L_7280
Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
Print #0; Tab 1;"TOTAL";
Print #0; Using "-----,--#.##"; Tab 11;TTOT[10];TTOT[5]; Tab 41;TTOT[11];
Print #0; Using "-----,--#.##";TTOT[6]; Tab 71;TTOT[12];TTOT[7];
Print #0; Using "---,---,--#.##"; Tab 101;TTOT[13];TTOT[14];
Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
Gosub L_7340
Print #0; Using "-----,--#.##"; Tab 11;T9[11];TTOT[0]; Tab 41;T9[12];
Print #0; Using "-----,--#.##";TTOT[1]; Tab 71;T9[13];TTOT[2];
Print #0; Using "---,---,--#.##"; Tab 101;T9[14];TTOT[3];
Print #0;"\15\" \ J1 = J1 + 2 \ Gosub L_5800
Print #0;"PROOF TOTAL";
Print #0; Using "-----,--#.##"; Tab 11;(TTOT[10] - T9[11]); Tab 41;(TTOT[11] - T9[12]);
Print #0; Using "-----,--#.##"; Tab 71;(TTOT[12] - T9[13]);
Print #0; Using "---,---,--#.##"; Tab 101;(TTOT[13] - T9[14]);TTOT[3];
Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
L_7280: Gosub L_7400
Return 
!
L_7300: Rem CHG PAID
T9[11] = FNR(T6[0] - (T5[0] - T4[0]))
T9[12] = FNR(T6[1] - (T5[1] - T4[1]))
T9[13] = FNR(T6[2] - (T5[2] - T4[2]))
T9[14] = FNR(T6[3] - (T5[3] - T4[3]))
Return 
!
L_7340: Rem TOT CHG PAID
T9[11] = FNR(TTOT[10] - (TTOT[5] - TTOT[0]))
T9[12] = FNR(TTOT[11] - (TTOT[6] - TTOT[1]))
T9[13] = FNR(TTOT[12] - (TTOT[7] - TTOT[2]))
T9[14] = FNR(TTOT[13] - (TTOT[8] - TTOT[3]))
Return 
L_7400: Rem DRAW AUD
For X = Len(F1$) To 1 Step -1
  If F1$[X,X] = "" Goto L_7420
  If F1$[X,X] <> " " Goto L_7430
L_7420: Next X
If X <= 1 Goto L_7480
L_7430: T9[1] = (TTOT[10] - T9[11]) \ T9[2] = (TTOT[11] - T9[12])
T9[3] = (TTOT[12] - T9[13]) \ T9[4] = (TTOT[13] - T9[14])
T9[0] = TTOT[3]
If W1 Let J2$ = (100 + W1) Using "###"
If W1 Goto L_7500
For X1 = 1 To D9[5]
  J2$ = (100 + X1) Using "###"
  Gosub L_7500
Next X1
If F Goto L_7655
L_7480: !If Err 0 Gosub ERR_ESCAPE
Return 
!
L_7500: Rem TRY FILE
F1$[X + 1] = J2$[2]
try Close #21 else rem
Try ! file may not exist!
	Open #21,F1$
Else
	Return ! try next whse
End Try
!!If Err 0 Gosub ERR_ESCAPE
Print #0;"  WHSE: ";J2$[2];
Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
Gosub L_5800
For F = 1 To Chf(21) - 1
  Read #21,F;H4[0],H4[1],H4[2],X2,TT2[11],T2[12],J2$;
  Gosub L_7700
  Print #0; Using "### "; Tab 1;H4[1];
  If H4[2] > 1 If H4[2] < 4 Goto L_7580
  Print #0; Using "-----,--#.##"; Tab 11;T2[12];
L_7580: Print #0; Tab 28;X$;
  If H4[2] = 2 Print #0; Using "-----,--#.##"; Tab 41;T2[12];
  J3$ = " ",J3$ \ J3$ = "OTHER TYPE" \ If H4[2] = 1 Let J3$ = "CASH"
  If H4[2] = 2 Let J3$ = TT2[11] Using "CHECK #########"
  If H4[2] <> 3 Goto L_7602
  J3$ = "CREDIT CARD"
  If TT2[11]
	if tt2[11]>0 and tt2[11]<11 Let J3$ = CCTYPE$[TT2[11] * 10 - 9,TT2[11] * 10]
  Endif
L_7602: Print #0; Tab 56;J3$;
  If H4[2] = 3 Print #0; Using "-----,--#.##"; Tab 71;T2[12];
  Print #0; Using "---,---,--#.##"; Tab 101;T2[12]; Tab 117;J2$[1,15];
  Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
  Gosub L_5800
  If H4[2] = 1 Let T9[1] = T9[1] + T2[12]
  If H4[2] = 2 Let T9[2] = T9[2] + T2[12]
  If H4[2] = 3 Let T9[3] = T9[3] + T2[12]
  If H4[2] = 4 Let T9[0] = T9[0] + T2[12]
  T9[4] = T9[4] + T2[12]
Next F
If Not(W1) Return 
L_7655: Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
Print #0;"FINAL PROOF";
Print #0; Using "-----,--#.##"; Tab 11;T9[1]; Tab 41;T9[2];
Print #0; Using "-----,--#.##"; Tab 71;T9[3];
Print #0; Using "---,---,--#.##"; Tab 101;T9[4];T9[0];
Print #0;"" \ J1 = J1 + 1 \ Gosub L_5800
Return 
!
L_7700: Rem "============================================= convert date
X$ = " ",X$ \ X$[10] = ""
X$[1,3] = Int(X2 / 10 ^ 2 - Int(X2 / 10 ^ 4) * 10 ^ 2) + 10 ^ 2 Using "###"
X$[4,6] = Fra(X2 / 10 ^ 2) * 10 ^ 2 + 10 ^ 2 Using "###"
X$[7,9] = Int(X2 / 10 ^ 4) + 10 ^ 2 Using "###"
X$[4,4] = "/" \ X$[7,7] = "/" \ X$ = X$[2]
Return 
!
JULTODATE: ! JULIAN TO MM/DD/YY
D3[0] = X2;FLAG = 1;X$ = " "
Call "JULIANUTIL",D3[],X$,FLAG
Return 
!!Call VerifyDate(X$,X$,E) \ If E Let X$ = "    "
!!X2 = X$[1,6]
!!Return 
!!X$ = X2 Using "&&&&&&"
!!Call DateToJulian(1,X$,X$,E) \ If E Return 
!!X2 = X$[1,5]
!!Return 1
!!D3[0] = X2;D3[1] = X2;FLAG = 0
!!Call "JULIANUTIL",D3[],X$,FLAG
!!Return 
!
L_7900: Rem CONVERT YYMM TO YYYYMM
X$ = X2 Using "&&&&"
D3[0] = X$[1,2];D3[1] = X$[3,4]
If D3[0] > 67 Let D3[0] = 1900 + D3[0]
If D3[0] < 68 Let D3[0] = 2000 + D3[0]
X$[1,4] = D3[0] Using "&&&&";X$[5,6] = D3[1] Using "&&"
X2 = X$[1,6] \ Return 
L_8000: Rem CALC EXTENDED TOTAL COST
EXTOTCOST = H5[14]
If COSTFLAG = 2 Return 
Rem! check here for total extend cost on rebate
EXTOTCOST = 0 \ If H5[7] = 16 Or H5[7] = 8 Return 
N0 = OREF[1] \ If H0[0] = 31 Let N0 = H0[7]
J2$ = " ",J2$ \ J2$ = N0 Using "##########   "
L_8030: 
Search #5,3,1;J2$,R5,E 
If E = 2 Goto L_8095
X3 = J2$[1,10] \ If X3 <> N0 Goto L_8095
Mat Read #5,R5,256;OLS2; \ If OLS2[0] = 3 Goto L_8030
Mat Read #5,R5,168;L7;
If S7 = 39 And H0[0] = 31 Let L7[10] = 0 - L7[10]
If COSTFLAG = 3 Or COSTFLAG = 4 ! getting the rebate cost
  Mat Read #5,R5,8;L3;
  Mat Read #5,R5,16;L4;
  Mat Read #5,R5,32;L5;
  Mat Read #5,R5,140;L1$;
  If S7=39 And H0[0]=31 Let L7[10]=0-L7[10] ! "credit on Both Run
  Gosub GETCOST3
  If S7=39 And H0[0]=31 Let L7[10]=0-L7[10] ! "credit on Both Run-FLIP IT & FLIP IT AGAIN(SEE ABOVE)
  If S7=39 And H0[0]=31 Let COST3=0-COST3 ! C/M & BOTH 
  EXTOTCOST = EXTOTCOST + FNR(L7[4] * COST3)
Else 
  EXTOTCOST = EXTOTCOST + L7[10]
End If 
Goto L_8030
L_8095: 
Return 
!
L_8800: Rem "================================================== clear jsdetl
K35$ = " ",K35$
L_8810:
Search #35,3,1;K35$,R35,E 
If E = 2 Goto L_8890
X3 = K35$[1,2] \ If X3 <> 0 Goto L_8890
Search #35,5,1;K35$,R35,E 
If E Let e$ = "syserrorfile 937a jsdtmp sortfile mode (m)=5 keyno (k)=1 r=",R35," e=",e," keyval (k$)=",K35$ \error 10000
E = 3
Search #35,1,0;K35$,R35,E 
If E Let e$ = "syserrorfile 937a jsdtmp sortfile mode (m)=1 keyno (k)=0 r=",R35," e=",e," keyval (k$)=",K35$ \error 10000
Goto L_8810
L_8890: 
Return 
!
L_9100: Rem END
Gosub L_4800
If P1 >= 2 And TYPE <> 0 Let TYPE = 9;TYPE[1] = 9
Gosub L_4000
!!If TYPE[1] And J8 Print @0,23;"PRESS <CR> TO CONTINUE ";'CL'; \ Input ""J$
For J = 0 To 20 \ T9[J] = 0 \ Next J
TOTCOST = 0;T11[1] = 0;T10[7] = 0
If TYPE[1] Goto L_9200
P1 = P1 + 1 \ If P1 > 2 Goto L_9200
Goto L_1940
L_9200: Rem GL FOR UD
If Not(PASS) Goto L_9250
TYPE = TYPE[1]
PASS = 0;SORT = 2
If Not(J8) Print #0;"\14\";
Goto L_1405
L_9250: Rem
If S7 = 7 Let JRNL = F8
S9[0] = S7;S9[1] = TYPE[1];S9[2] = W1;S9[3] = JRNL;S9[4] = GLDET
! TFLE$[Len(TFLE$)] = "" 
tRY Close #16 Else Rem
Try Kill TFLE$ Else Rem
Goto OUTEND
Stop 
!
L_10000: Rem SLSM
K11$ = " ",K11$
K11$ = H0[11] Using "###"
Search #11,2,1;K11$,R11,E !!\ If E > 1 Gosub ERR_SEARCH
If E = 1 Let S2$ = " ",S2$ \ S2$ = "SALESMAN NOT ON FILE" \ Return 
Mat Read #11,R11,0;S2$;
Mat Read #11,R11,118;SLSMS1;
Mat Read #11,R11,142;CAT;
If SORT <> 2 Goto L_10190
SLSMTDGP = 0;SLSYTDGP = 0
SLSMTDSL = 0;SLSYTDSL = 0
For X = 0 To 19
  SLSMTDGP = SLSMTDGP + CAT[X,4]
  SLSYTDGP = SLSYTDGP + CAT[X,5]
  SLSMTDSL = SLSMTDSL + CAT[X,2]
  SLSYTDSL = SLSYTDSL + CAT[X,3]
Next X
L_10190: Return 
!
L_10500: Rem CHECK FOR COST VS LOAD/WHSE COST CHANGE
LDCOST = PRODB[8]
If P9$[32,32] <> "Y" Goto L_10600
K17$ = " ",K17$;K17$[1,12] = L1$[1,12];K17$[13,14] = H4[2] Using "##"
Search #17,2,1;K17$,R17,E 
If E Goto L_10600
Mat Read #17,R17,78;W3;
If W3[17] Let LDCOST = W3[17]
Goto L_10600
L_10600: Rem CHECK IF DIFF
COSTCHG = 0
CNVTU[0] = 0;CNVTU[1] = UN[2];CNVTU[2] = 2;CNVTA = L5[1]
If CPSAME Let CNVTU[1] = UN[1]
If L7[4] And COSTFLAG = 1 And L7[10] <> 0 Let CNVTA = (L7[10] / L7[4])
If COSTFLAG = 3 Or COSTFLAG = 4 ! rebate/netpo or rebate/gl
  Gosub GETCOST3
  CNVTA = COST3
End If 
Gosub L_20000 \ CUNIT = AMOUNT
CNVTU[0] = 0;CNVTU[1] = UN[2];CNVTU[2] = 2;CNVTA = LDCOST
If CPSAME Let CNVTU[1] = UN[1]
Gosub L_20000 \ LDCOST = AMOUNT
If LDCOST <> CUNIT Let COSTCHG = 1
Return 
!
L_11000: Rem WHSE/DIV/TYPE TOTALS
For J = 0 To 11 \ JTTL[J] = 0 \ Next J
J1 = 90
K35$ = " ",K35$
L_11040: Search #35,3,1;K35$,R[35],E \ If E = 2 Goto L_11295
!!If E Gosub ERR_SEARCH
Mat Read #35,R[35],0;JTL;
Mat Read #35,R[35],6;JTL1;
Gosub L_11300
Print #0;"" \ J1 = J1 + 1
Goto L_11040
L_11295: Return 
L_11300: Rem PRINT INFO
If J8 Return
!
J1 = J1 + 1
Gosub L_11500
Print #0; Tab 1;"JOURNAL";
Print #0; Using "##"; Tab 10;JTL[0]; Tab 15;JTL[1]; Tab 20;JTL[2];
Print #0; Using "------,--#.##"; Tab 57;JTL1[1];
If SORT = 2 If Not(PRTSCOST) Goto L_11345
Print #0; Using "------,--#.##"; Tab 71;JTL1[1] - JTL1[9]; Tab 85;JTL1[9];
L_11345: Print #0; Using "#######"; Tab 99;JTL1[10];
Print #0; Using "#########"; Tab 107;JTL1[11];
Print #0; Using "-------,--#.##"; Tab 117;JTL1[8];
Print #0;""
Return 
!
L_11500: Rem heading
If J8 Return
!
If J1 < J9 Return 
!!If J2 If J8 Input @0,23;"PRESS <CR> TO CONTINUE "J$ \ Print 'CS';
If J2 Print #0;"\14\";
J2 = J2 + 1 \ J1 = 8
Print #0;"\15\";
Print #0; Tab 10;ARDATE$; Tab (64 - Len(CNAME$) / 2);CNAME$; Tab 120;"PAGE";J2
Print #0;" - 937A - ";Msc$(3);
Print #0; Tab 45;"M O N T H L Y   I N V O I C E   J O U R N A L";
If W1 Print #0; Tab 100;D9$;":";W1
If Not(W1) Print #0; Tab 100;"ALL ";D9$;"S"
Print #0; Tab 5;N1$;
If DIV Print #0; Tab 100;"DIVISION:";DIV Else Print #0; Tab 100;"ALL DIVISIONS"
Print #0;""
Print #0; Tab 18;"ORDER"
Print #0; Tab 9;"WHSE"; Tab 14;"DIV."; Tab 19;"TYPE";
Print #0; Tab 65;"MERCH";
If SORT = 2 If Not(PRTSCOST) Goto L_11585
If COSTFLAG = 1 Print #0; Tab 77;"G/L";
If COSTFLAG = 2 Print #0; Tab 76;"LOAD";
If COSTFLAG = 3 Print #0; Tab 75;"RB/NET";
If COSTFLAG = 4 Print #0; Tab 75;" RB/GL";
Print #0; Tab 80;"COST"; Tab 95;"G/P";
L_11585: Print #0; Tab 100;"# INVS"; Tab 109;"# LINES"; Tab 125;"POUNDS"
Print #0;"" \ Return
L_20000: Rem UNITX CONVERSION RETURNS AMOUNT  (rev 01/07/1992)
If CNVTU[2] = 3 Goto L_20050
If CNVTU[2] = 1 And CNVTU[1] = CNVTU[0] Let AMOUNT = CNVTA \ Goto L_20160
If CNVTU[0] = -2 Or CNVTU[1] = -2 Let AMOUNT = CNVTA \ Goto L_20160
If CNVTU[2] = 0 Goto L_20050
If Not(CNVTA) Let AMOUNT = 0 \ Goto L_20160
L_20050: Goto L_20120 !!If Spc(4) > 1280 Goto L_20120
Swap 1,"MXPRCONV"
If CNVTU[2] = 3 Goto L_20160
L_20080: Signal 2,X1,AMOUNT,FLAG \ If X1 = -1 Let E = 0 !!\ Gosub ERR_SEARCH
If X1 <> Spc(6) Goto L_20080
If CNVTU[2] = 0 Goto L_20160
If FLAG Let E = FLAG !!\ Gosub ERR_SEARCH
Goto L_20160
L_20120: Rem "====== unibasic 5+ logic
Call "MXPRCONV5",PFU1[],PFU2[],A[],CNVTU[],CNVTA,SC,SR,FLAG
If CNVTU[2] = 0 Goto L_20160
If FLAG Let E = FLAG !!\ Gosub ERR_SEARCH
AMOUNT = CNVTA
L_20160: Return 
!
L_30000: Rem ===== set units for conversions (stock/nonstock version)
If OLS2[0] = 3 Goto L_30099
A[6] = L6[4];A[5] = UNF[5] \ If Not(A[5]) Let A[5] = 1;UNF[5] = 1
PFU1[0] = EUN[0];PFU1[1] = UN[0]
PFU1[2] = UN[1];PFU1[3] = UN[2]
PFU1[4] = EUN[1]
PFU1[5] = 0;PFU1[6] = 0;PFU1[7] = 0
PFU1[8] = UN[0];PFU1[9] = UN[0];PFU1[10] = EUN[1]
PFU1[11] = UN[2];PFU1[12] = UN[1]
If Not(L3[0]) Goto L_30060
PFU1[13] = UN[0];PFU1[16] = EUN[0];PFU1[17] = EUN[0]
PFU1[18] = UN[0];PFU1[19] = UN[0]
L_30060: PFU2[0] = UNF[0];PFU2[1] = UNF[1]
PFU2[2] = UNF[2];PFU2[3] = UNF[3]
PFU2[4] = 0;PFU2[5] = 0;PFU2[6] = 0
For X1 = 1 To 4
  For X2 = 0 To X1 - 1
    If PFU1[X1] = PFU1[X2] Let PFU1[X1] = 0;PFU2[X1 - 1] = 0
  Next X2
Next X1
L_30099: Return 
!
OPENHISTFILE: Rem
Close #18
X14$ = "4/SORDFLEHHKEY" + Str$(intCo)
Open #18,X14$
Return 
!
GETCOST3: Rem get rebate cost or net po cost : ! "check for any rebate
If H5[7] = 16 Or H5[7] = 8 ! transfer or stocking consignments
  COST3 = 0
  Return 
End If 
COST3 = 0;REBFLAG = 0
If L3 ! nonstock item
  If L7[7]
    COST3 = L7[7]
  Else 
    If L7[4]
      COST3 = L7[10] / L7[4]
    Else 
      COST3 = L5[1]
    End If 
  End If 
  STATUS = 99
  Return 
End If 
K7$ = " ",K7$;K7$[1,12] = L1$[1,12]
Search #7,2,1;K7$,REC_PROD,E 
If E = 1 ! product not found default to g/l cost
  If L7[4]
    COST3 = L7[10] / L7[4]
  Else 
    COST3 = L5[1]
  End If 
  Return 
End If 
Mat Read #7,REC_PROD,0;P1$;
Mat Read #7,REC_PROD,156;PRODB;
Mat Read #7,REC_PROD,256;A;
Mat Read #7,REC_PROD,512;PFU1;
Mat Read #7,REC_PROD,554;PFU2;
Mat Read #7,REC_PROD,596;PRPARC;
If L4[3] = 0 Let L4[3] = H4[2]
NETPOCOST = PRPARC[2]
REC_PRWH = 0
If P9$[32,32] = "Y"
  K17$ = " ",K17$;K17$[1,12] = L1$[1,12];K17$[13,14] = L4[3] Using "##"
  Search #17,2,1;K17$,REC_PRWH,E !!\ If E > 1 Gosub ERR_SEARCH
  If Not(E)
    Mat Read #17,REC_PRWH,800;WHMISC;
    If WHMISC[2] Let NETPOCOST = WHMISC[2]
  End If 
End If 
J3$ = " ",J3$;J3$[1,6] = H0[4] Using "######"
Search #6,2,1;J3$,R6,E 
If E = 1
  C1[7] = 0
Else 
  Mat Read #6,R6,142;C1;
End If 
Mat REBATE_ARGS = Zer
REBATE_ARGS[1,0] = 7
REBATE_ARGS[2,0] = 17
REBATE_ARGS[3,0] = 19
REBATE_ARGS[4,0] = 20
REBATE_ARGS[5,0] = 22
REBATE_ARGS[1,1] = REC_PROD
REBATE_ARGS[2,1] = REC_PRWH
REBATE_ARGS[1,2] = L4[3]
REBATE_ARGS[2,2] = H0[4]
REBATE_ARGS[3,2] = 0
REBATE_ARGS[4,2] = H0[9]
REBATE_ARGS[5,2] = C1[7]
!Call "rebates",REBATE_ARGS[],P1$[140,151],STATUS
j1$="" ! debug log name
Call rebates(e$,REBATE_ARGS[],P1$[140,151],STATUS,0,j1$,rstr$) ! new external sub
If Not(STATUS) !"indicates call was successful in finding rebate
  COST3 = REBATE_ARGS[1,3]
  REBFLAG = 99
Else 
  If COSTFLAG = 3
    COST3 = NETPOCOST
  Else 
    If COSTFLAG = 4
      If L7[7]
        COST3 = L7[7]
      Else 
        If L7[4]
          COST3 = L7[10] / L7[4]
        Else 
          COST3 = L5[1]
        End If 
      End If 
    End If 
  End If 
End If 
A[6] = L6[4];A[5] = UNF[5] \ If Not(A[5]) Let A[5] = 1;UNF[5] = 1
Return 
!
Rem {begin rtn.error.s}
OUTEND: Rem EXIT
! dx close
!!XML END!
If J8 If comd = 1 call addtostr(e$,rstr$,tmp1$+rdel$)
!
If j8 ! dx xml
  Call addtostr(e$,rstr$,esdel$) !end section
  Call setoutput(e$,rstr$,1) !1 flag puts 0 status seciton in, puts </page> in
End If 
!
Try Call dxclose() Else REM
End 
!
!!I$ = "6/JSDTMP";I$[Len(I$) + 1] = Spc(6) Using "&&&&"
!!Call FindF(I$,S1) \ If Not(S1) Goto L_9007
!!Kill I$
!!L_9007: Rem LET TFLE$[LEN TFLE$]="" \ CLOSE #16 \ KILL TFLE$
!!Print 'CS'
!!Chain "MX000C"
!!Stop 
!
ERR_TRAP: Rem *Error routine (escape trap)   V3.1 8/94 G.DOSCHER/REK
! dx replace entire error routine
include "src/callmainerrnet.inc"
End 
